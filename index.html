<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ElectroCultivo Espa√±a - Juego de Agricultura</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700&display=swap"
        rel="stylesheet">
    <style>
        * {
            font-family: 'Nunito', sans-serif;
        }

        .title-font {
            font-family: 'Fredoka One', cursive;
        }

        .region {
            transition: all 0.3s;
            cursor: pointer;
            stroke-width: 0.5;
            stroke: #1a3d18;
        }

        .region:hover {
            filter: brightness(1.1);
            transform: scale(1.02);
            z-index: 50;
        }

        .region.locked {
            filter: grayscale(100%) brightness(0.7);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .region.locked:hover {
            transform: none;
            filter: grayscale(100%) brightness(0.7);
        }

        .region.current {
            stroke: #ffd700;
            stroke-width: 3;
            filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.6));
        }

        /* Flag Patterns */
        .flag-fill {
            fill-opacity: 0.8;
        }

        .region:hover .flag-fill {
            fill-opacity: 1;
        }

        /* Estilos de parcela realista */
        .farm-plot {
            position: relative;
            border-radius: 8px;
            transition: all 0.3s;
            overflow: hidden;
        }

        .farm-plot::before {
            content: '';
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(0deg,
                    transparent,
                    transparent 4px,
                    rgba(0, 0, 0, 0.1) 4px,
                    rgba(0, 0, 0, 0.1) 8px);
            pointer-events: none;
        }

        .farm-plot.unplowed {
            background: linear-gradient(145deg, #4d3a24 0%, #3a2b1b 100%);
            background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0h20v20H0z' fill='none'/%3E%3Cpath d='M2 2l2 2m4 4l2 2m-8 6l2 2m12-14l2 2' stroke='%23302010' stroke-width='1'/%3E%3C/svg%3E");
        }

        .farm-plot.plowed {
            background: linear-gradient(145deg, #8B5A2B 0%, #6B4423 50%, #5D3A1A 100%);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3), inset 0 -2px 4px rgba(255, 255, 255, 0.1);
        }

        .farm-plot.planted {
            background: linear-gradient(145deg, #654321 0%, #5D3A1A 50%, #4A2F15 100%);
        }

        .farm-plot.watered {
            background: linear-gradient(145deg, #4A3520 0%, #3D2B18 50%, #2F2010 100%);
        }

        .farm-plot.watered::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(100, 150, 255, 0.3) 0%, transparent 50%);
            pointer-events: none;
            animation: waterMist 2s infinite alternate;
        }

        @keyframes waterMist {
            from {
                opacity: 0.3;
            }

            to {
                opacity: 0.6;
            }
        }

        .farm-plot:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .farm-plot.ready {
            animation: harvestPulse 1.5s infinite;
        }

        @keyframes harvestPulse {

            0%,
            100% {
                box-shadow: 0 0 10px #4ade80, 0 0 20px #4ade8055;
                transform: scale(1);
            }

            50% {
                box-shadow: 0 0 20px #4ade80, 0 0 40px #4ade8088;
                transform: scale(1.02);
            }
        }

        @keyframes plantGrow {
            0% {
                transform: scale(0) translateY(20px);
                opacity: 0;
            }

            50% {
                transform: scale(1.2) translateY(-5px);
            }

            100% {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .plant-icon {
            animation: plantGrow 0.5s ease-out;
        }

        @keyframes sway {

            0%,
            100% {
                transform: rotate(-2deg);
            }

            50% {
                transform: rotate(2deg);
            }
        }

        .plant-sway {
            animation: sway 3s ease-in-out infinite;
            transform-origin: bottom center;
        }

        /* Granja realista */
        .farm-container {
            position: relative;
            background: linear-gradient(180deg,
                    #87CEEB 0%,
                    #87CEEB 25%,
                    #a8d5a2 25%,
                    #7cb342 60%,
                    #558b2f 100%);
            min-height: 100vh;
        }

        .farm-container.autumn {
            background: linear-gradient(180deg,
                    #c9a86c 0%,
                    #deb887 25%,
                    #c4a265 25%,
                    #9a7b4f 60%,
                    #6b5530 100%);
        }

        .farm-container.winter {
            background: linear-gradient(180deg,
                    #b8c6d4 0%,
                    #d4e5f7 25%,
                    #e8efe8 25%,
                    #c9d9c5 60%,
                    #a8b8a4 100%);
        }

        .farm-container.summer {
            background: linear-gradient(180deg,
                    #4a90c2 0%,
                    #6bb3d9 25%,
                    #7cb342 25%,
                    #558b2f 60%,
                    #33691e 100%);
        }

        /* Elementos decorativos */
        .sun {
            position: absolute;
            top: 20px;
            right: 40px;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #FFD93D 0%, #FF9800 100%);
            border-radius: 50%;
            box-shadow: 0 0 60px #FFD93D, 0 0 100px #FF980088;
            animation: sunGlow 4s ease-in-out infinite;
        }

        @keyframes sunGlow {

            0%,
            100% {
                box-shadow: 0 0 60px #FFD93D, 0 0 100px #FF980088;
            }

            50% {
                box-shadow: 0 0 80px #FFD93D, 0 0 120px #FF9800aa;
            }
        }

        .cloud {
            position: absolute;
            background: white;
            border-radius: 50px;
            opacity: 0.9;
            animation: floatCloud 20s linear infinite;
        }

        @keyframes floatCloud {
            0% {
                transform: translateX(-100px);
            }

            100% {
                transform: translateX(calc(100vw + 100px));
            }
        }

        .fence {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 60'%3E%3Crect x='5' y='10' width='8' height='50' fill='%238B4513'/%3E%3Crect x='45' y='10' width='8' height='50' fill='%238B4513'/%3E%3Crect x='85' y='10' width='8' height='50' fill='%238B4513'/%3E%3Crect x='0' y='20' width='100' height='6' fill='%23A0522D'/%3E%3Crect x='0' y='40' width='100' height='6' fill='%23A0522D'/%3E%3C/svg%3E") repeat-x;
            background-size: 100px 60px;
            pointer-events: none;
        }

        .barn {
            position: absolute;
            right: 20px;
            top: 120px;
            width: 120px;
            height: 100px;
        }

        .windmill {
            position: absolute;
            left: 30px;
            top: 100px;
            font-size: 4rem;
            animation: spin 8s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        /* Campo de cultivo central */
        .field-area {
            background: linear-gradient(145deg, #8B6914 0%, #6B5210 100%);
            border: 8px solid #5D4510;
            border-radius: 20px;
            box-shadow:
                inset 0 4px 20px rgba(0, 0, 0, 0.3),
                0 10px 40px rgba(0, 0, 0, 0.4);
            position: relative;
        }

        .field-area::before {
            content: '';
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(90deg,
                    transparent,
                    transparent 60px,
                    rgba(0, 0, 0, 0.05) 60px,
                    rgba(0, 0, 0, 0.05) 62px);
            border-radius: 12px;
            pointer-events: none;
        }

        /* Progress bar mejorado */
        .growth-bar {
            position: absolute;
            bottom: 4px;
            left: 4px;
            right: 4px;
            height: 6px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 3px;
            overflow: hidden;
        }

        .growth-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ade80, #22c55e);
            border-radius: 3px;
            transition: width 0.5s;
        }

        /* Yield badge */
        .yield-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 5px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }

        /* Interacciones de Arar y Regar */
        .hold-progress {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.4);
            z-index: 20;
            pointer-events: none;
        }

        .hold-progress-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top-color: #fbbf24;
            animation: spin 1s linear infinite;
        }

        /* Harvest Fullscreen */
        #harvestOverlay:not(.hidden) {
            display: flex;
        }

        #harvestOverlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 100;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            backdrop-filter: blur(10px);
        }

        .harvest-fruit {
            font-size: 5rem;
            cursor: pointer;
            transition: all 0.3s;
            filter: drop-shadow(0 0 10px rgba(0, 0, 0, 0.5));
            animation: float 3s ease-in-out infinite;
        }

        .harvest-fruit:hover {
            transform: scale(1.2);
        }

        .harvest-fruit.picked {
            animation: pickEffect 0.5s forwards;
            pointer-events: none;
        }

        @keyframes pickEffect {
            0% {
                transform: scale(1.2);
            }

            50% {
                transform: scale(1.5);
                opacity: 0.5;
            }

            100% {
                transform: scale(0);
                opacity: 0;
            }
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        .spray-cursor {
            cursor: crosshair !important;
        }

        .hose-effect {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(100, 200, 255, 0.4) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }

        /* Electrocultura efectos */
        .electro-active {
            position: relative;
        }

        .electro-active::after {
            content: '‚ö°';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            animation: sparkle 1s infinite;
        }

        @keyframes sparkle {

            0%,
            100% {
                opacity: 0.3;
                transform: translateX(-50%) scale(0.8);
            }

            50% {
                opacity: 1;
                transform: translateX(-50%) scale(1.2);
            }
        }

        /* Gu√≠a */
        .guide-bubble {
            position: relative;
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
            border-radius: 20px;
            border: 3px solid #8B4513;
        }

        .guide-bubble::after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 30px;
            border: 10px solid transparent;
            border-top-color: #8B4513;
        }

        /* Minijuego */
        .minigame-container {
            position: relative;
            width: 100%;
            height: 400px;
            background: linear-gradient(180deg, #87CEEB 0%, #4a7c3f 100%);
            border-radius: 20px;
            overflow: hidden;
        }

        .falling-item {
            position: absolute;
            font-size: 2rem;
            cursor: pointer;
            transition: transform 0.1s;
            user-select: none;
        }

        .falling-item:hover {
            transform: scale(1.3);
        }

        @keyframes catchEffect {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.5);
            }

            100% {
                transform: scale(0);
                opacity: 0;
            }
        }

        .caught {
            animation: catchEffect 0.3s forwards;
        }

        /* Inventario visual */
        .inventory-item {
            background: linear-gradient(145deg, #fef3c7, #fcd34d);
            border: 2px solid #b45309;
            border-radius: 10px;
            padding: 8px;
            text-align: center;
            transition: all 0.2s;
        }

        .inventory-item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* Scrollbar personalizado */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #8B4513;
            border-radius: 4px;
        }
    </style>

</head>

<body class="bg-gradient-to-br from-green-800 via-green-700 to-emerald-900 min-h-screen overflow-x-hidden">
    <!-- Pantalla de Inicio -->
    <div id="startScreen"
        class="fixed inset-0 flex items-center justify-center z-50 bg-gradient-to-br from-amber-700 via-green-800 to-emerald-900">
        <div class="text-center p-8 max-w-2xl">
            <div class="mb-8 relative">
                <div class="text-8xl mb-4">üåæ</div>
                <div class="absolute -top-2 right-1/4 text-4xl animate-bounce" style="animation-delay: 0.5s;">‚ö°</div>
            </div>
            <h1 class="title-font text-5xl md:text-6xl text-yellow-300 mb-4 drop-shadow-lg">ElectroCultivo Espa√±a</h1>
            <p class="text-xl text-green-200 mb-8">Cultiva la tierra con las t√©cnicas ancestrales de la
                electrocultura<br>Recorre todas las regiones agr√≠colas de Espa√±a</p>

            <div class="bg-black/30 rounded-xl p-4 mb-6 text-left">
                <p class="text-amber-300 font-bold mb-2">üéÆ Caracter√≠sticas del juego:</p>
                <ul class="text-green-200 text-sm space-y-1">
                    <li>üå± <b>Rendimientos realistas</b>: Cada planta produce como en la vida real</li>
                    <li>üìÖ <b>Cultivos de temporada</b>: Siembra seg√∫n la estaci√≥n del a√±o</li>
                    <li>üó∫Ô∏è <b>15 regiones de Espa√±a</b>: Desbloquea nuevas zonas al subir de nivel</li>
                    <li>‚ö° <b>Electrocultura</b>: Mejora tus cosechas con t√©cnicas el√©ctricas</li>
                    <li>üë®‚Äçüåæ <b>Pedro el agricultor</b>: Tu mentor te guiar√° en el camino</li>
                </ul>
            </div>

            <button onclick="startGame()"
                class="bg-yellow-500 hover:bg-yellow-400 text-amber-900 font-bold text-2xl px-12 py-4 rounded-full shadow-xl transform hover:scale-105 transition-all">
                üöú Comenzar Aventura
            </button>
            <p class="text-green-300 mt-6 text-sm">üçÇ Comenzar√°s en Oto√±o en Castilla-La Mancha</p>
        </div>
    </div>

    <!-- Contenedor Principal del Juego -->
    <div id="gameContainer" class="hidden">
        <!-- Barra Superior Fija -->
        <header class="bg-gradient-to-r from-amber-900 to-amber-800 p-3 shadow-xl sticky top-0 z-50">
            <div class="container mx-auto flex justify-between items-center flex-wrap gap-2">
                <div class="flex items-center gap-4">
                    <h1 class="title-font text-xl md:text-2xl text-yellow-300 cursor-pointer" onclick="showView('map')">
                        üåæ ElectroCultivo</h1>
                    <div id="seasonIndicator" class="px-3 py-1 rounded-full text-white font-bold text-sm bg-orange-700">
                        üçÇ Oto√±o
                    </div>
                </div>
                <div class="flex gap-2 md:gap-4 items-center flex-wrap">
                    <div class="bg-amber-950 px-3 py-1 rounded-lg flex items-center gap-1">
                        <span class="text-xl">üí∞</span>
                        <span id="money" class="text-yellow-400 font-bold text-lg">500</span>
                    </div>
                    <div class="bg-amber-950 px-3 py-1 rounded-lg flex items-center gap-1">
                        <span class="text-xl">‚ö°</span>
                        <span id="energy" class="text-blue-400 font-bold text-lg">100</span>
                    </div>
                    <div class="bg-amber-950 px-3 py-1 rounded-lg flex items-center gap-1">
                        <span class="text-xl">‚≠ê</span>
                        <span id="level" class="text-green-400 font-bold text-lg">1</span>
                    </div>
                    <div class="bg-amber-950 px-3 py-1 rounded-lg hidden md:flex items-center gap-2">
                        <div class="w-24 h-3 bg-gray-700 rounded-full overflow-hidden">
                            <div id="xpBarHeader" class="h-full bg-purple-500 transition-all" style="width: 0%"></div>
                        </div>
                        <span id="xpText" class="text-purple-300 text-xs">0/100</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navegaci√≥n Principal -->
        <nav class="bg-amber-800/90 p-2 sticky top-14 z-40 shadow-lg">
            <div class="container mx-auto flex gap-2 justify-center flex-wrap">
                <button onclick="showView('map')" id="navMap"
                    class="nav-btn bg-green-700 hover:bg-green-600 text-white px-4 md:px-6 py-2 rounded-lg font-bold transition-all flex items-center gap-1">
                    <span>üó∫Ô∏è</span><span class="hidden sm:inline">Mapa</span>
                </button>
                <button onclick="showView('farm')" id="navFarm"
                    class="nav-btn bg-amber-700 hover:bg-amber-600 text-white px-4 md:px-6 py-2 rounded-lg font-bold transition-all flex items-center gap-1">
                    <span>üå±</span><span class="hidden sm:inline">Granja</span>
                </button>
                <button onclick="showView('minigame')" id="navMinigame"
                    class="nav-btn bg-pink-700 hover:bg-pink-600 text-white px-4 md:px-6 py-2 rounded-lg font-bold transition-all flex items-center gap-1">
                    <span>üéÆ</span><span class="hidden sm:inline">Minijuegos</span>
                </button>
                <button onclick="showView('shop')" id="navShop"
                    class="nav-btn bg-blue-700 hover:bg-blue-600 text-white px-4 md:px-6 py-2 rounded-lg font-bold transition-all flex items-center gap-1">
                    <span>üõí</span><span class="hidden sm:inline">Tienda</span>
                </button>
                <button onclick="showView('electroculture')" id="navElectro"
                    class="nav-btn bg-yellow-600 hover:bg-yellow-500 text-white px-4 md:px-6 py-2 rounded-lg font-bold transition-all flex items-center gap-1">
                    <span>‚ö°</span><span class="hidden sm:inline">Electro</span>
                </button>
                <button onclick="showView('inventory')" id="navInventory"
                    class="nav-btn bg-purple-700 hover:bg-purple-600 text-white px-4 md:px-6 py-2 rounded-lg font-bold transition-all flex items-center gap-1">
                    <span>üì¶</span><span class="hidden sm:inline">Inventario</span>
                </button>
            </div>
        </nav>

        <!-- Vista del Mapa de Espa√±a -->
        <div id="mapView" class="container mx-auto p-4">
            <div class="text-center mb-6">
                <h2 class="title-font text-3xl text-yellow-300 mb-2">üó∫Ô∏è Regiones Agr√≠colas de Espa√±a</h2>
                <p class="text-green-200">Cada regi√≥n tiene su propia granja y cultivos √∫nicos</p>
                <div class="mt-3 inline-flex items-center gap-4 bg-amber-900/50 px-4 py-2 rounded-full">
                    <span class="text-yellow-300 font-bold">Regiones desbloqueadas:</span>
                    <span id="unlockedCount" class="text-white text-xl font-bold">1 / 15</span>
                </div>
            </div>

            <div class="grid grid-cols-1 xl:grid-cols-4 gap-6">
                <div class="xl:col-span-3 bg-gradient-to-b from-blue-400 to-blue-600 rounded-2xl p-4 shadow-2xl">
                    <div class="relative w-full bg-blue-500 rounded-xl overflow-hidden" style="padding-bottom: 70%;">
                        <svg viewBox="0 0 800 600" class="absolute inset-0 w-full h-full">
                            <defs>
                                <!-- Flag Patterns (Optimized) -->
                                <pattern id="flag-galicia" patternUnits="objectBoundingBox" width="1" height="1">
                                    <image
                                        href="https://upload.wikimedia.org/wikipedia/commons/b/b1/Bandera_de_Galicia.svg"
                                        x="0" y="0" width="1" height="1" preserveAspectRatio="xMidYMid slice" />
                                </pattern>
                                <pattern id="flag-asturias" patternUnits="objectBoundingBox" width="1" height="1">
                                    <image
                                        href="https://upload.wikimedia.org/wikipedia/commons/3/3e/Bandera_de_Asturias.svg"
                                        x="0" y="0" width="1" height="1" preserveAspectRatio="xMidYMid slice" />
                                </pattern>
                                <pattern id="flag-cantabria" patternUnits="objectBoundingBox" width="1" height="1">
                                    <image
                                        href="https://upload.wikimedia.org/wikipedia/commons/3/30/Bandera_de_Cantabria.svg"
                                        x="0" y="0" width="1" height="1" preserveAspectRatio="xMidYMid slice" />
                                </pattern>
                                <pattern id="flag-paisvasco" patternUnits="objectBoundingBox" width="1" height="1">
                                    <image
                                        href="https://upload.wikimedia.org/wikipedia/commons/2/2d/Bandera_del_Pa%C3%ADs_Vasco.svg"
                                        x="0" y="0" width="1" height="1" preserveAspectRatio="xMidYMid slice" />
                                </pattern>
                                <pattern id="flag-navarra" patternUnits="objectBoundingBox" width="1" height="1">
                                    <image
                                        href="https://upload.wikimedia.org/wikipedia/commons/a/af/Bandera_de_Navarra.svg"
                                        x="0" y="0" width="1" height="1" preserveAspectRatio="xMidYMid slice" />
                                </pattern>
                                <pattern id="flag-larioja" patternUnits="objectBoundingBox" width="1" height="1">
                                    <image
                                        href="https://upload.wikimedia.org/wikipedia/commons/d/db/Bandera_de_La_Rioja.svg"
                                        x="0" y="0" width="1" height="1" preserveAspectRatio="xMidYMid slice" />
                                </pattern>
                                <pattern id="flag-aragon" patternUnits="objectBoundingBox" width="1" height="1">
                                    <image
                                        href="https://upload.wikimedia.org/wikipedia/commons/1/18/Bandera_de_Arag%C3%B3n.svg"
                                        x="0" y="0" width="1" height="1" preserveAspectRatio="xMidYMid slice" />
                                </pattern>
                                <pattern id="flag-cataluna" patternUnits="objectBoundingBox" width="1" height="1">
                                    <image
                                        href="https://upload.wikimedia.org/wikipedia/commons/c/ce/Bandera_de_Catalu%C3%B1a.svg"
                                        x="0" y="0" width="1" height="1" preserveAspectRatio="xMidYMid slice" />
                                </pattern>
                                <pattern id="flag-castillayleon" patternUnits="objectBoundingBox" width="1" height="1">
                                    <image
                                        href="https://upload.wikimedia.org/wikipedia/commons/1/13/Bandera_de_Castilla_y_Le%C3%B3n.svg"
                                        x="0" y="0" width="1" height="1" preserveAspectRatio="xMidYMid slice" />
                                </pattern>
                                <pattern id="flag-madrid" patternUnits="objectBoundingBox" width="1" height="1">
                                    <image
                                        href="https://upload.wikimedia.org/wikipedia/commons/9/9c/Bandera_de_la_Comunidad_de_Madrid.svg"
                                        x="0" y="0" width="1" height="1" preserveAspectRatio="xMidYMid slice" />
                                </pattern>
                                <pattern id="flag-castillalamancha" patternUnits="objectBoundingBox" width="1"
                                    height="1">
                                    <image
                                        href="https://upload.wikimedia.org/wikipedia/commons/d/d4/Bandera_Castilla-La_Mancha.svg"
                                        x="0" y="0" width="1" height="1" preserveAspectRatio="xMidYMid slice" />
                                </pattern>
                                <pattern id="flag-extremadura" patternUnits="objectBoundingBox" width="1" height="1">
                                    <image
                                        href="https://upload.wikimedia.org/wikipedia/commons/4/4d/Bandera_de_Extremadura.svg"
                                        x="0" y="0" width="1" height="1" preserveAspectRatio="xMidYMid slice" />
                                </pattern>
                                <pattern id="flag-valencia" patternUnits="objectBoundingBox" width="1" height="1">
                                    <image
                                        href="https://upload.wikimedia.org/wikipedia/commons/d/df/Bandera_de_la_Comunidad_Valenciana.svg"
                                        x="0" y="0" width="1" height="1" preserveAspectRatio="xMidYMid slice" />
                                </pattern>
                                <pattern id="flag-murcia" patternUnits="objectBoundingBox" width="1" height="1">
                                    <image
                                        href="https://upload.wikimedia.org/wikipedia/commons/a/a5/Bandera_de_la_Regi%C3%B3n_de_Murcia.svg"
                                        x="0" y="0" width="1" height="1" preserveAspectRatio="xMidYMid slice" />
                                </pattern>
                                <pattern id="flag-andalucia" patternUnits="objectBoundingBox" width="1" height="1">
                                    <image
                                        href="https://upload.wikimedia.org/wikipedia/commons/2/20/Bandera_de_Andaluc%C3%ADa.svg"
                                        x="0" y="0" width="1" height="1" preserveAspectRatio="xMidYMid slice" />
                                </pattern>
                            </defs>

                            <rect x="0" y="0" width="800" height="600" fill="#2563eb" /> <!-- Mar -->

                            <!-- Tierra Circundante -->
                            <path d="M0,0 L800,0 L800,600 L0,600 Z" fill="#1e40af" opacity="0.3" />
                            <path d="M60,200 L110,180 L130,220 L140,300 L130,380 L110,420 L80,410 L60,340 Z"
                                fill="#d4c5a0" stroke="#1a3d18" stroke-width="1" /> <!-- Portugal -->
                            <text x="95" y="310" fill="#4b5563" font-size="10" font-weight="bold"
                                opacity="0.5">PORTUGAL</text>
                            <path d="M580,20 L780,10 L790,80 L760,110 L730,120 L580,70 Z" fill="#d4c5a0"
                                stroke="#1a3d18" stroke-width="1" /> <!-- Francia -->
                            <text x="680" y="50" fill="#4b5563" font-size="10" font-weight="bold"
                                opacity="0.5">FRANCIA</text>

                            <!-- Regiones de Espa√±a -->
                            <path id="region-galicia" class="region locked"
                                d="M100,120 L180,100 L210,130 L200,190 L150,210 L110,200 L90,160 Z"
                                fill="url(#flag-galicia)" onclick="selectRegion('galicia')" />
                            <path id="region-asturias" class="region locked"
                                d="M180,100 L280,85 L310,110 L280,145 L200,155 L190,135 Z" fill="url(#flag-asturias)"
                                onclick="selectRegion('asturias')" />
                            <path id="region-cantabria" class="region locked"
                                d="M300,85 L380,75 L395,100 L370,130 L300,135 L300,110 Z" fill="url(#flag-cantabria)"
                                onclick="selectRegion('cantabria')" />
                            <path id="region-paisvasco" class="region locked"
                                d="M380,75 L440,70 L460,95 L445,125 L395,120 L395,100 Z" fill="url(#flag-paisvasco)"
                                onclick="selectRegion('paisvasco')" />
                            <path id="region-navarra" class="region locked"
                                d="M440,70 L520,65 L560,105 L530,145 L460,135 L460,100 Z" fill="url(#flag-navarra)"
                                onclick="selectRegion('navarra')" />
                            <path id="region-larioja" class="region locked"
                                d="M370,130 L445,125 L460,135 L460,170 L400,180 L370,160 Z" fill="url(#flag-larioja)"
                                onclick="selectRegion('larioja')" />
                            <path id="region-aragon" class="region locked"
                                d="M460,135 L560,105 L630,125 L650,210 L630,310 L540,330 L480,290 L460,210 Z"
                                fill="url(#flag-aragon)" onclick="selectRegion('aragon')" />
                            <path id="region-cataluna" class="region locked"
                                d="M630,125 L730,105 L760,190 L730,290 L650,310 L630,210 Z" fill="url(#flag-cataluna)"
                                onclick="selectRegion('cataluna')" />
                            <path id="region-castillayleon" class="region locked"
                                d="M150,195 L280,145 L370,145 L400,180 L425,250 L380,310 L280,330 L180,310 L135,260 L135,225 Z"
                                fill="url(#flag-castillayleon)" onclick="selectRegion('castillayleon')" />
                            <path id="region-madrid" class="region locked"
                                d="M320,300 L380,290 L400,330 L370,370 L320,350 Z" fill="url(#flag-madrid)"
                                onclick="selectRegion('madrid')" />
                            <path id="region-castillalamancha" class="region"
                                d="M280,330 L425,290 L540,330 L570,390 L530,460 L380,470 L300,430 L275,370 Z"
                                fill="url(#flag-castillalamancha)" onclick="selectRegion('castillalamancha')" />
                            <path id="region-extremadura" class="region locked"
                                d="M125,290 L185,310 L275,350 L285,410 L245,460 L165,460 L110,410 Z"
                                fill="url(#flag-extremadura)" onclick="selectRegion('extremadura')" />
                            <path id="region-valencia" class="region locked"
                                d="M540,330 L650,290 L690,350 L670,430 L610,460 L540,430 L550,390 Z"
                                fill="url(#flag-valencia)" onclick="selectRegion('valencia')" />
                            <path id="region-murcia" class="region locked"
                                d="M540,430 L610,460 L630,500 L565,515 L505,485 L525,455 Z" fill="url(#flag-murcia)"
                                onclick="selectRegion('murcia')" />
                            <path id="region-andalucia" class="region locked"
                                d="M105,410 L245,460 L385,460 L525,485 L545,515 L485,550 L300,550 L150,520 L85,460 L85,430 Z"
                                fill="url(#flag-andalucia)" onclick="selectRegion('andalucia')" />

                            <!-- Etiquetas Blancas (sobre las banderas) -->
                            <!-- Etiquetas Blancas (Centradas y Optimizadas) -->
                            <g style="pointer-events:none;">
                                <text x="150" y="160" fill="white" font-size="12" text-anchor="middle"
                                    font-weight="bold" stroke="black" stroke-width="0.5">Galicia</text>
                                <text x="245" y="125" fill="white" font-size="11" text-anchor="middle"
                                    font-weight="bold" stroke="black" stroke-width="0.5">Asturias</text>
                                <text x="345" y="110" fill="white" font-size="10" text-anchor="middle"
                                    font-weight="bold" stroke="black" stroke-width="0.5">Cantabria</text>
                                <text x="420" y="100" fill="white" font-size="10" text-anchor="middle"
                                    font-weight="bold" stroke="black" stroke-width="0.5">Pa√≠s Vasco</text>
                                <text x="510" y="110" fill="white" font-size="11" text-anchor="middle"
                                    font-weight="bold" stroke="black" stroke-width="0.5">Navarra</text>
                                <text x="425" y="155" fill="white" font-size="9" text-anchor="middle" font-weight="bold"
                                    stroke="black" stroke-width="0.4">La Rioja</text>
                                <text x="550" y="220" fill="white" font-size="14" text-anchor="middle"
                                    font-weight="bold" stroke="black" stroke-width="0.6">Arag√≥n</text>
                                <text x="700" y="200" fill="white" font-size="14" text-anchor="middle"
                                    font-weight="bold" stroke="black" stroke-width="0.6">Catalu√±a</text>
                                <text x="270" y="240" fill="white" font-size="16" text-anchor="middle"
                                    font-weight="bold" stroke="black" stroke-width="0.8">Castilla y Le√≥n</text>
                                <text x="360" y="330" fill="white" font-size="10" text-anchor="middle"
                                    font-weight="bold" stroke="black" stroke-width="0.5">Madrid</text>
                                <text x="410" y="390" fill="white" font-size="16" text-anchor="middle"
                                    font-weight="bold" stroke="black" stroke-width="0.8">Castilla-La Mancha</text>
                                <text x="200" y="390" fill="white" font-size="13" text-anchor="middle"
                                    font-weight="bold" stroke="black" stroke-width="0.6">Extremadura</text>
                                <text x="610" y="380" fill="white" font-size="13" text-anchor="middle"
                                    font-weight="bold" stroke="black" stroke-width="0.6">Valencia</text>
                                <text x="565" y="485" fill="white" font-size="11" text-anchor="middle"
                                    font-weight="bold" stroke="black" stroke-width="0.5">Murcia</text>
                                <text x="320" y="510" fill="white" font-size="18" text-anchor="middle"
                                    font-weight="bold" stroke="black" stroke-width="1.0">Andaluc√≠a</text>
                            </g>

                            <!-- Leyenda -->
                            <rect x="20" y="510" width="140" height="70" fill="rgba(0,0,0,0.6)" rx="8" />
                            <text x="90" y="530" fill="#ffd700" font-size="10" text-anchor="middle"
                                font-weight="bold">LEYENDA</text>
                            <circle cx="35" cy="545" r="5" fill="#ffd700" />
                            <text x="50" y="548" fill="white" font-size="9">Regi√≥n Actual</text>
                            <circle cx="35" cy="565" r="5" fill="#666" opacity="0.6" />
                            <text x="50" y="568" fill="white" font-size="9">Bloqueada</text>
                        </svg>
                    </div>
                </div>

                <div class="xl:col-span-1 space-y-4">
                    <div id="regionInfo" class="bg-amber-900/80 rounded-2xl p-5">
                        <h3 class="title-font text-xl text-yellow-300 mb-3">üìç Selecciona una Regi√≥n</h3>
                        <p class="text-green-200 text-sm">Haz clic en una regi√≥n del mapa para ver informaci√≥n.</p>
                    </div>

                    <div class="bg-amber-900/80 rounded-2xl p-5">
                        <h3 class="title-font text-lg text-yellow-300 mb-3">üìÖ Temporada Actual</h3>
                        <div id="seasonInfoPanel" class="bg-amber-950/50 rounded-xl p-3 text-center">
                            <p class="text-4xl mb-2">üçÇ</p>
                            <p class="text-white font-bold text-lg">Oto√±o</p>
                            <p class="text-amber-300 text-xs mt-1">Ideal para cereales y legumbres</p>
                        </div>
                    </div>

                    <div class="bg-amber-900/80 rounded-2xl p-5">
                        <h3 class="title-font text-lg text-yellow-300 mb-3">üèÜ Progreso</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between text-sm">
                                <span class="text-green-200">Nivel</span>
                                <span id="levelProgress" class="text-white font-bold text-xl">1</span>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-4">
                                <div id="xpBar"
                                    class="bg-gradient-to-r from-purple-600 to-purple-400 h-4 rounded-full transition-all"
                                    style="width: 0%"></div>
                            </div>
                            <p class="text-gray-400 text-xs text-center">XP: <span id="xpProgress">0</span>/<span
                                    id="xpNeededProgress">100</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vista de Granja (Pantalla Completa) -->
        <div id="farmView" class="hidden">
            <div id="farmFullscreen" class="farm-container autumn min-h-screen relative">
                <!-- Elementos decorativos -->
                <div class="sun"></div>
                <div class="cloud" style="top: 50px; width: 100px; height: 40px; animation-delay: 0s;"></div>
                <div class="cloud" style="top: 80px; width: 80px; height: 30px; animation-delay: -7s;"></div>
                <div class="cloud" style="top: 30px; width: 120px; height: 50px; animation-delay: -14s;"></div>

                <!-- Molino -->
                <div class="windmill hidden md:block">üåÄ</div>

                <!-- Granero -->
                <div class="barn hidden md:block">
                    <div class="text-6xl">üè†</div>
                </div>

                <!-- Cabecera de la Granja -->
                <div class="bg-gradient-to-r from-amber-900/95 to-amber-800/95 p-3 sticky top-0 z-20 shadow-xl">
                    <div class="container mx-auto flex justify-between items-center flex-wrap gap-2">
                        <div class="flex items-center gap-3">
                            <button onclick="showView('map')"
                                class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-2 rounded-lg transition-all">
                                ‚Üê Mapa
                            </button>
                            <div>
                                <h2 class="title-font text-xl text-yellow-300" id="farmRegionTitle">üåæ Granja de
                                    Castilla-La Mancha</h2>
                                <p class="text-green-200 text-sm">üìÖ D√≠a <span id="currentDay">1</span> | <span
                                        id="currentSeasonText">üçÇ Oto√±o</span> | A√±o <span id="currentYear">1</span></p>
                            </div>
                        </div>
                        <div class="flex gap-2 items-center flex-wrap">
                            <div id="electrocultureStatus" class="bg-gray-700 px-3 py-1 rounded-lg text-sm">
                                <span class="text-gray-400">‚ö° Sin electrocultura</span>
                            </div>
                            <button onclick="advanceDay()"
                                class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg font-bold flex items-center gap-1 transition-all">
                                ‚è≠Ô∏è Siguiente D√≠a
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Contenido Principal de la Granja -->
                <div class="container mx-auto p-4 relative z-10">
                    <div class="grid grid-cols-1 lg:grid-cols-5 gap-4">
                        <!-- Campo de Cultivo -->
                        <div class="lg:col-span-4">
                            <div class="field-area p-4 md:p-6">
                                <div class="flex justify-between items-center mb-4 flex-wrap gap-2">
                                    <div>
                                        <h3 class="text-white font-bold text-xl">üåæ Campo de Cultivo</h3>
                                        <p class="text-amber-200 text-sm">Parcelas: <span id="plotCount">12</span></p>
                                    </div>
                                    <div class="flex gap-2 flex-wrap">
                                        <button onclick="waterAll()"
                                            class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg font-bold flex items-center gap-1 transition-all shadow-lg">
                                            üíß Regar Todo (10‚ö°)
                                        </button>
                                        <button onclick="harvestAll()"
                                            class="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg font-bold flex items-center gap-1 transition-all shadow-lg">
                                            üåæ Cosechar Todo
                                        </button>
                                    </div>
                                </div>

                                <div id="farmGrid"
                                    class="grid grid-cols-4 sm:grid-cols-5 md:grid-cols-6 lg:grid-cols-8 gap-3 md:gap-4">
                                    <!-- Parcelas generadas din√°micamente -->
                                </div>

                                <div class="mt-6 flex gap-3 flex-wrap justify-center">
                                    <button onclick="expandFarm()"
                                        class="bg-amber-700 hover:bg-amber-600 text-white px-6 py-3 rounded-xl font-bold transition-all shadow-lg">
                                        ‚ûï Expandir Campo (500üí∞)
                                    </button>
                                </div>
                            </div>

                            <!-- Info de rendimiento -->
                            <div class="mt-4 bg-black/40 backdrop-blur-sm rounded-xl p-4">
                                <div class="flex items-center gap-4 justify-center flex-wrap text-sm">
                                    <span class="text-green-300">üå± Haz clic en <b>+</b> para plantar</span>
                                    <span class="text-blue-300">üíß Riega para +50% velocidad</span>
                                    <span class="text-yellow-300">‚ú® Cosecha cuando brille</span>
                                </div>
                            </div>
                        </div>

                        <!-- Panel Lateral -->
                        <div class="lg:col-span-1">
                            <div class="bg-amber-900/90 backdrop-blur-sm rounded-2xl p-4 sticky top-32 space-y-4">
                                <div>
                                    <h3 class="title-font text-lg text-yellow-300 mb-3">üå± Mis Semillas</h3>
                                    <div id="seedList" class="space-y-2 max-h-48 overflow-y-auto">
                                    </div>
                                    <button onclick="showView('shop')"
                                        class="mt-3 w-full bg-blue-600 hover:bg-blue-500 text-white py-2 rounded-lg text-sm font-bold transition-all">
                                        üõí Comprar Semillas
                                    </button>
                                </div>

                                <div class="pt-4 border-t border-amber-700">
                                    <h4 class="text-amber-300 font-bold text-sm mb-2">üì¶ Almac√©n</h4>
                                    <div id="quickInventory" class="space-y-1 max-h-40 overflow-y-auto text-sm">
                                        <p class="text-gray-400">Vac√≠o</p>
                                    </div>
                                    <p class="text-gray-500 text-xs mt-2 text-center">Total: <span
                                            id="totalHarvestValue">0</span>üí∞</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Valla inferior -->
                <div class="fence"></div>
            </div>
        </div>

        <!-- Vista de Inventario -->
        <div id="inventoryView" class="container mx-auto p-4 hidden">
            <div class="text-center mb-6">
                <h2 class="title-font text-3xl text-yellow-300 mb-2">üì¶ Inventario de Cosechas</h2>
                <p class="text-green-200">Tus productos cosechados con rendimientos realistas</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-amber-900/80 rounded-2xl p-5">
                    <h3 class="title-font text-xl text-green-300 mb-4">üåæ Productos</h3>
                    <div id="inventoryGrid" class="grid grid-cols-2 sm:grid-cols-3 gap-3 max-h-96 overflow-y-auto">
                        <p class="text-gray-400 col-span-full text-center py-8">Sin cosechas a√∫n</p>
                    </div>
                </div>

                <div class="bg-amber-900/80 rounded-2xl p-5">
                    <h3 class="title-font text-xl text-yellow-300 mb-4">üí∞ Vender Productos</h3>
                    <div id="sellInventory" class="space-y-2 max-h-96 overflow-y-auto">
                        <p class="text-gray-400 text-center py-8">Cosecha productos para venderlos aqu√≠</p>
                    </div>
                    <div class="mt-4 pt-4 border-t border-amber-700">
                        <div class="flex justify-between items-center">
                            <span class="text-white font-bold">Valor Total:</span>
                            <span id="totalInventoryValue" class="text-yellow-400 font-bold text-2xl">0 üí∞</span>
                        </div>
                        <button onclick="sellAll()"
                            class="mt-3 w-full bg-green-600 hover:bg-green-500 text-white py-3 rounded-xl font-bold transition-all">
                            üí∞ Vender Todo
                        </button>
                    </div>
                </div>
            </div>

            <!-- Informaci√≥n de rendimientos -->
            <div class="mt-6 bg-black/40 rounded-2xl p-5">
                <h3 class="title-font text-xl text-yellow-300 mb-4">üìä Gu√≠a de Rendimientos por Planta</h3>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3 text-sm">
                    <div class="bg-green-900/50 p-3 rounded-lg text-center">
                        <span class="text-2xl">üçÖ</span>
                        <p class="text-white font-bold">Tomate</p>
                        <p class="text-green-300">15-25 unid.</p>
                    </div>
                    <div class="bg-green-900/50 p-3 rounded-lg text-center">
                        <span class="text-2xl">üçá</span>
                        <p class="text-white font-bold">Uva</p>
                        <p class="text-green-300">8-15 kg</p>
                    </div>
                    <div class="bg-green-900/50 p-3 rounded-lg text-center">
                        <span class="text-2xl">üåæ</span>
                        <p class="text-white font-bold">Trigo</p>
                        <p class="text-green-300">3-6 kg</p>
                    </div>
                    <div class="bg-green-900/50 p-3 rounded-lg text-center">
                        <span class="text-2xl">üçä</span>
                        <p class="text-white font-bold">Naranja</p>
                        <p class="text-green-300">80-150 unid.</p>
                    </div>
                    <div class="bg-green-900/50 p-3 rounded-lg text-center">
                        <span class="text-2xl">ü´í</span>
                        <p class="text-white font-bold">Aceituna</p>
                        <p class="text-green-300">15-30 kg</p>
                    </div>
                    <div class="bg-green-900/50 p-3 rounded-lg text-center">
                        <span class="text-2xl">üå∏</span>
                        <p class="text-white font-bold">Azafr√°n</p>
                        <p class="text-green-300">0.5-1.5 g</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vista de Minijuegos -->
        <div id="minigameView" class="container mx-auto p-4 hidden">
            <div class="text-center mb-6">
                <h2 class="title-font text-3xl text-yellow-300 mb-2">üéÆ Minijuegos del Campo</h2>
                <p class="text-green-200">¬°Gana dinero y energ√≠a extra mientras te diviertes!</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto">
                <div
                    class="bg-gradient-to-br from-green-900/80 to-emerald-900/80 rounded-2xl p-6 border-2 border-green-600">
                    <div class="text-4xl mb-3">üß∫</div>
                    <h3 class="title-font text-2xl text-yellow-300 mb-2">Atrapa la Cosecha</h3>
                    <p class="text-green-200 text-sm mb-4">Haz clic en las frutas que caen. ¬°Evita las piedras!</p>
                    <div class="bg-black/30 rounded-xl p-3 mb-4">
                        <p class="text-amber-300 text-sm">üéÅ Recompensa: <span class="text-white font-bold">+5üí∞ por
                                fruta</span></p>
                        <p class="text-amber-300 text-sm">‚ö° Coste: <span class="text-white font-bold">10 energ√≠a</span>
                        </p>
                    </div>
                    <button onclick="startMinigame('catch')"
                        class="w-full bg-green-600 hover:bg-green-500 text-white py-3 rounded-xl font-bold text-lg transition-all">
                        üéØ ¬°Jugar!
                    </button>
                </div>

                <div class="bg-gradient-to-br from-red-900/80 to-orange-900/80 rounded-2xl p-6 border-2 border-red-600">
                    <div class="text-4xl mb-3">üêõ</div>
                    <h3 class="title-font text-2xl text-yellow-300 mb-2">Elimina Plagas</h3>
                    <p class="text-green-200 text-sm mb-4">Aplasta los insectos antes de que se coman tus cultivos.</p>
                    <div class="bg-black/30 rounded-xl p-3 mb-4">
                        <p class="text-amber-300 text-sm">üéÅ Recompensa: <span class="text-white font-bold">+3üí∞ por
                                plaga</span></p>
                        <p class="text-amber-300 text-sm">‚ö° Coste: <span class="text-white font-bold">5 energ√≠a</span>
                        </p>
                    </div>
                    <button onclick="startMinigame('pest')"
                        class="w-full bg-red-600 hover:bg-red-500 text-white py-3 rounded-xl font-bold text-lg transition-all">
                        üéØ ¬°Jugar!
                    </button>
                </div>

                <div class="bg-gradient-to-br from-blue-900/80 to-cyan-900/80 rounded-2xl p-6 border-2 border-blue-600">
                    <div class="text-4xl mb-3">üíß</div>
                    <h3 class="title-font text-2xl text-yellow-300 mb-2">Riego R√°pido</h3>
                    <p class="text-green-200 text-sm mb-4">Riega las plantas marchitas antes de que se sequen.</p>
                    <div class="bg-black/30 rounded-xl p-3 mb-4">
                        <p class="text-amber-300 text-sm">üéÅ Recompensa: <span class="text-white font-bold">+25‚ö°
                                energ√≠a</span></p>
                        <p class="text-amber-300 text-sm">‚ö° Coste: <span class="text-white font-bold">GRATIS</span></p>
                    </div>
                    <button onclick="startMinigame('water')"
                        class="w-full bg-blue-600 hover:bg-blue-500 text-white py-3 rounded-xl font-bold text-lg transition-all">
                        üéØ ¬°Jugar!
                    </button>
                </div>

                <div
                    class="bg-gradient-to-br from-purple-900/80 to-yellow-900/80 rounded-2xl p-6 border-2 border-purple-600">
                    <div class="text-4xl mb-3">‚ö°</div>
                    <h3 class="title-font text-2xl text-yellow-300 mb-2">Carga El√©ctrica</h3>
                    <p class="text-green-200 text-sm mb-4">Activa los nodos de electrocultura en secuencia.</p>
                    <div class="bg-black/30 rounded-xl p-3 mb-4">
                        <p class="text-amber-300 text-sm">üéÅ Recompensa: <span class="text-white font-bold">+40‚ö°
                                +25üí∞</span></p>
                        <p class="text-amber-300 text-sm">‚ö° Coste: <span class="text-white font-bold">15 energ√≠a</span>
                        </p>
                    </div>
                    <button onclick="startMinigame('electric')"
                        class="w-full bg-purple-600 hover:bg-purple-500 text-white py-3 rounded-xl font-bold text-lg transition-all">
                        üéØ ¬°Jugar!
                    </button>
                </div>
            </div>
        </div>

        <!-- Vista de Tienda -->
        <div id="shopView" class="container mx-auto p-4 hidden">
            <div class="text-center mb-6">
                <h2 class="title-font text-3xl text-yellow-300 mb-2">üõí Tienda del Pueblo</h2>
                <p class="text-green-200">Compra semillas de <span id="shopRegionName"
                        class="text-yellow-300 font-bold">Castilla-La Mancha</span></p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="bg-amber-900/80 rounded-2xl p-5">
                    <h3 class="title-font text-xl text-green-300 mb-4">üå± Semillas Disponibles</h3>
                    <div id="shopSeeds" class="space-y-2 max-h-96 overflow-y-auto">
                    </div>
                </div>

                <div class="bg-amber-900/80 rounded-2xl p-5">
                    <h3 class="title-font text-xl text-blue-300 mb-4">üîß Herramientas</h3>
                    <div id="shopTools" class="space-y-2 max-h-96 overflow-y-auto">
                    </div>
                </div>

                <div class="bg-amber-900/80 rounded-2xl p-5">
                    <h3 class="title-font text-xl text-yellow-300 mb-4">‚ö° Electrocultura</h3>
                    <div id="shopElectro" class="space-y-2 max-h-96 overflow-y-auto">
                    </div>
                </div>
            </div>
        </div>

        <!-- Vista de Electrocultura -->
        <div id="electrocultureView" class="container mx-auto p-4 hidden">
            <div class="text-center mb-6">
                <h2 class="title-font text-3xl text-yellow-300 mb-2">‚ö° Centro de Electrocultura</h2>
                <p class="text-green-200">T√©cnicas el√©ctricas ancestrales para potenciar tus cultivos</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-gradient-to-br from-purple-900/80 to-blue-900/80 rounded-2xl p-6">
                    <h3 class="title-font text-xl text-yellow-300 mb-4">üì° Mis Equipos</h3>
                    <div id="electroTechniques" class="space-y-3">
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="bg-gradient-to-br from-green-900/80 to-emerald-900/80 rounded-2xl p-6">
                        <h3 class="title-font text-xl text-green-300 mb-4">‚ú® Beneficios Activos</h3>
                        <div id="activeBenefits" class="space-y-2">
                            <p class="text-gray-400">Ning√∫n equipo instalado</p>
                        </div>
                    </div>

                    <div class="bg-black/40 rounded-2xl p-6">
                        <h4 class="text-yellow-300 font-bold mb-3">üìñ ¬øQu√© es la Electrocultura?</h4>
                        <p class="text-green-200 text-sm leading-relaxed mb-3">
                            La electrocultura utiliza campos electromagn√©ticos y electricidad atmosf√©rica para estimular
                            el crecimiento vegetal.
                            Estas t√©cnicas ancestrales pueden aumentar los rendimientos hasta un 300%.
                        </p>
                        <ul class="text-green-300 text-sm space-y-1">
                            <li>üì° <b>Antenas de cobre</b>: Captan electricidad del aire</li>
                            <li>üß≤ <b>Polos magn√©ticos</b>: Orientan nutrientes a las ra√≠ces</li>
                            <li>üî∫ <b>Pir√°mides</b>: Concentran energ√≠a c√≥smica</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gu√≠a del Agricultor -->
        <div id="guidePanel" class="fixed bottom-4 left-4 z-40 max-w-sm">
            <div class="guide-bubble p-4 shadow-xl">
                <p id="guideText" class="text-gray-700 text-sm">¬°Bienvenido, joven agricultor! Soy Pedro. Es oto√±o, la
                    mejor √©poca para sembrar cereales. Te he dado semillas de trigo, cebada y el valioso azafr√°n de La
                    Mancha. ¬°Vamos a la granja!</p>
            </div>
            <div class="flex items-end mt-2 gap-2">
                <div class="text-5xl">üë®‚Äçüåæ</div>
                <div class="flex-1">
                    <p class="text-yellow-300 font-bold text-sm">Pedro</p>
                    <p class="text-green-300 text-xs">50 a√±os de experiencia</p>
                </div>
                <button onclick="nextGuideMessage()"
                    class="bg-green-600 hover:bg-green-500 text-white px-3 py-1 rounded-full text-sm transition-all">‚Üí</button>
                <button onclick="hideGuide()"
                    class="bg-red-500 hover:bg-red-400 text-white px-2 py-1 rounded-full text-sm transition-all">‚úï</button>
            </div>
        </div>
        <button id="showGuideBtn" onclick="showGuide()"
            class="fixed bottom-4 left-4 z-30 bg-amber-600 hover:bg-amber-500 text-white p-4 rounded-full shadow-xl hidden text-3xl transition-all">
            üë®‚Äçüåæ
        </button>
    </div>

    <!-- Modal de Regi√≥n -->
    <div id="regionModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0" onclick="closeRegionModal()"></div>
        <div
            class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-gradient-to-br from-amber-900 to-amber-800 rounded-2xl p-6 max-w-lg w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <button onclick="closeRegionModal()"
                class="absolute top-4 right-4 text-white hover:text-red-400 text-2xl">‚úï</button>
            <div id="regionModalContent"></div>
        </div>
    </div>

    <!-- Modal de Plantaci√≥n -->
    <div id="plantModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0" onclick="closePlantModal()"></div>
        <div
            class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-gradient-to-br from-green-900 to-green-800 rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl max-h-[80vh] overflow-hidden">
            <button onclick="closePlantModal()"
                class="absolute top-4 right-4 text-white hover:text-red-400 text-2xl">‚úï</button>
            <h3 class="title-font text-xl text-yellow-300 mb-4">üå± Selecciona Semilla</h3>
            <div id="plantModalSeeds" class="space-y-2 max-h-96 overflow-y-auto pr-2">
            </div>
        </div>
    </div>

    <!-- Modal de Minijuego -->
    <div id="minigameModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0"></div>
        <div
            class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-gradient-to-br from-green-900 to-emerald-800 rounded-2xl p-6 max-w-2xl w-full mx-4 shadow-2xl">
            <div class="flex justify-between items-center mb-4">
                <h3 id="minigameTitle" class="title-font text-2xl text-yellow-300">üéÆ Minijuego</h3>
                <div class="flex items-center gap-4">
                    <div class="bg-black/30 px-4 py-2 rounded-lg">
                        <span class="text-yellow-300">Puntos: </span>
                        <span id="minigameScore" class="text-white font-bold text-xl">0</span>
                    </div>
                    <div class="bg-black/30 px-4 py-2 rounded-lg">
                        <span class="text-blue-300">‚è±Ô∏è </span>
                        <span id="minigameTimer" class="text-white font-bold text-xl">30</span>s
                    </div>
                </div>
            </div>
            <div id="minigameArea" class="minigame-container">
            </div>
            <div class="mt-4 flex justify-center">
                <button onclick="closeMinigame()"
                    class="bg-red-600 hover:bg-red-500 text-white px-8 py-2 rounded-lg font-bold transition-all">
                    ‚úï Salir
                </button>
            </div>
        </div>
    </div>
    <!-- Overlay de Cosecha Realista -->
    <div id="harvestOverlay" class="hidden">
        <div class="text-center mb-10">
            <h2 id="harvestTitle" class="title-font text-5xl text-yellow-300 drop-shadow-lg mb-2">üçé ¬°Cosecha el Fruto!
            </h2>
            <p id="harvestDesc" class="text-green-200 text-xl font-bold">¬°Haz clic en cada fruto para recogerlo!</p>
        </div>
        <div id="harvestFruitArea"
            class="relative w-full max-w-4xl h-[60vh] flex flex-wrap justify-center items-center gap-10">
            <!-- Frutos generados din√°micamente -->
        </div>
        <div class="mt-10">
            <div class="bg-black/50 px-8 py-4 rounded-full border-2 border-yellow-500">
                <span class="text-2xl text-white">üì¶ Recogidos: </span>
                <span id="collectedCount" class="text-3xl text-yellow-400 font-bold">0</span>
                <span id="totalToCollect" class="text-3xl text-gray-400 font-bold"> / 10</span>
            </div>
        </div>
    </div>

    <script>
        // ============ DATOS DEL JUEGO ============
        const gameData = {
            money: 500,
            energy: 100,
            maxEnergy: 100,
            level: 1,
            xp: 0,
            xpNeeded: 100,
            day: 1,
            season: 'autumn',
            year: 1,
            currentRegion: 'castillalamancha',
            unlockedRegions: ['castillalamancha'],
            farms: {},
            inventory: {
                seeds: {},
                harvests: {},
                tools: { azada: true }
            },
            electroculture: {
                copperAntenna: false,
                magneticPoles: false,
                pyramidStructure: false,
                electroStimulator: false,
                cosmicAntenna: false
            },
            selectedPlotIndex: null,
            guideMessageIndex: 0,
            isHolding: false,
            isSpraying: false,
            sprayTarget: null
        };

        let holdTimer = null;
        let sprayTimer = null;
        let harvestFruits = [];
        let collectedFruits = 0;

        const guideMessages = [
            "¬°Bienvenido, joven agricultor! Soy Pedro. Es oto√±o, la mejor √©poca para sembrar cereales. Te he dado semillas de trigo, cebada y el valioso azafr√°n de La Mancha.",
            "Ve a la GRANJA (üå±) arriba. Ver√°s un campo con parcelas de tierra. Haz clic en '+' para plantar.",
            "Cada planta produce rendimientos REALISTAS. Una vid de uvas te dar√° 8-15 kg, un naranjo 80-150 naranjas...",
            "El azafr√°n es el ORO de La Mancha. Una planta da 0.5-1.5g, ¬°pero vale 200üí∞ el gramo!",
            "RIEGA tus cultivos (üíß) para que crezcan 50% m√°s r√°pido. Cada d√≠a pasa, tus plantas crecen.",
            "Cuando una planta BRILLE, est√° lista para cosechar. ¬°Haz clic para recogerla!",
            "Juega MINIJUEGOS (üéÆ) para ganar dinero y energ√≠a extra. ¬°El de riego es gratis!",
            "La ELECTROCULTURA (‚ö°) multiplica tus rendimientos. Compra antenas de cobre para empezar.",
            "Sube de NIVEL cosechando para desbloquear nuevas regiones con cultivos √∫nicos.",
            "¬°Buena suerte! Toca mi cara (üë®‚Äçüåæ) si me necesitas. Ahora, ¬°a plantar!"
        ];

        // Regiones con niveles
        const regions = {
            castillalamancha: {
                name: 'Castilla-La Mancha', level: 1, emoji: 'üåæ', farmSize: 12,
                crops: ['trigo', 'cebada', 'azafran', 'uva', 'girasol', 'almendra']
            },
            aragon: {
                name: 'Arag√≥n', level: 2, emoji: 'üçë', farmSize: 14,
                crops: ['trigo', 'cebada', 'melocoton', 'cereza', 'olivo', 'almendra', 'maiz']
            },
            extremadura: {
                name: 'Extremadura', level: 3, emoji: 'ü´í', farmSize: 14,
                crops: ['olivo', 'cereza', 'higo', 'tomate', 'pimiento']
            },
            larioja: {
                name: 'La Rioja', level: 4, emoji: 'üçá', farmSize: 10,
                crops: ['uva', 'pimiento', 'champi√±on', 'pera', 'manzana']
            },
            murcia: {
                name: 'Murcia', level: 5, emoji: 'üçã', farmSize: 16,
                crops: ['limon', 'naranja', 'lechuga', 'brocoli', 'alcachofa', 'melon']
            },
            valencia: {
                name: 'Valencia', level: 6, emoji: 'üçä', farmSize: 16,
                crops: ['naranja', 'arroz', 'tomate', 'kaki', 'albaricoque']
            },
            cataluna: {
                name: 'Catalu√±a', level: 7, emoji: 'üå∞', farmSize: 18,
                crops: ['uva', 'avellana', 'manzana', 'pera', 'olivo', 'fresa']
            },
            castillayleon: {
                name: 'Castilla y Le√≥n', level: 8, emoji: 'üåª', farmSize: 20,
                crops: ['trigo', 'cebada', 'lentejas', 'garbanzos', 'remolacha', 'patata', 'girasol']
            },
            navarra: {
                name: 'Navarra', level: 9, emoji: 'ü´ë', farmSize: 16,
                crops: ['esparrago', 'pimiento', 'alcachofa', 'uva', 'melocoton']
            },
            paisvasco: {
                name: 'Pa√≠s Vasco', level: 10, emoji: 'üçè', farmSize: 14,
                crops: ['manzana', 'pimiento', 'alubia', 'patata']
            },
            cantabria: {
                name: 'Cantabria', level: 11, emoji: 'ü•ù', farmSize: 14,
                crops: ['manzana', 'kiwi', 'patata', 'maiz']
            },
            asturias: {
                name: 'Asturias', level: 12, emoji: 'üçé', farmSize: 14,
                crops: ['manzana', 'kiwi', 'arandano', 'frambuesa']
            },
            galicia: {
                name: 'Galicia', level: 13, emoji: 'ü•î', farmSize: 16,
                crops: ['patata', 'pimiento', 'uva', 'kiwi', 'manzana']
            },
            madrid: {
                name: 'Madrid', level: 14, emoji: 'üçì', farmSize: 12,
                crops: ['fresa', 'olivo', 'uva', 'melon', 'ajo']
            },
            andalucia: {
                name: 'Andaluc√≠a', level: 15, emoji: 'ü•ë', farmSize: 24,
                crops: ['olivo', 'naranja', 'fresa', 'aguacate', 'mango', 'tomate', 'pimiento', 'almendra', 'uva', 'algodon']
            }
        };

        // CULTIVOS CON RENDIMIENTOS REALISTAS
        const crops = {
            // Cereales (kg por planta/m¬≤)
            trigo: {
                name: 'Trigo', emoji: 'üåæ', seasons: ['autumn', 'winter'], growTime: 8, pricePerUnit: 0.25, seedPrice: 3,
                yieldMin: 3, yieldMax: 6, unit: 'kg', description: '3-6 kg de grano por m¬≤'
            },
            cebada: {
                name: 'Cebada', emoji: 'üåæ', seasons: ['autumn', 'winter'], growTime: 7, pricePerUnit: 0.22, seedPrice: 2,
                yieldMin: 3, yieldMax: 5, unit: 'kg', description: '3-5 kg de grano por m¬≤'
            },
            maiz: {
                name: 'Ma√≠z', emoji: 'üåΩ', seasons: ['spring', 'summer'], growTime: 6, pricePerUnit: 0.35, seedPrice: 4,
                yieldMin: 2, yieldMax: 4, unit: 'kg', description: '2-4 mazorcas grandes'
            },
            arroz: {
                name: 'Arroz', emoji: 'üçö', seasons: ['spring', 'summer'], growTime: 7, pricePerUnit: 0.50, seedPrice: 5,
                yieldMin: 4, yieldMax: 8, unit: 'kg', description: '4-8 kg por m¬≤'
            },

            // Hortalizas (unidades o kg)
            tomate: {
                name: 'Tomate', emoji: 'üçÖ', seasons: ['spring', 'summer'], growTime: 4, pricePerUnit: 0.80, seedPrice: 5,
                yieldMin: 15, yieldMax: 25, unit: 'unid', description: '15-25 tomates por planta'
            },
            lechuga: {
                name: 'Lechuga', emoji: 'ü•¨', seasons: ['spring', 'autumn'], growTime: 2, pricePerUnit: 0.50, seedPrice: 2,
                yieldMin: 1, yieldMax: 1, unit: 'unid', description: '1 lechuga grande'
            },
            pimiento: {
                name: 'Pimiento', emoji: 'ü´ë', seasons: ['spring', 'summer'], growTime: 5, pricePerUnit: 1.20, seedPrice: 4,
                yieldMin: 8, yieldMax: 15, unit: 'unid', description: '8-15 pimientos por planta'
            },
            brocoli: {
                name: 'Br√≥coli', emoji: 'ü•¶', seasons: ['autumn', 'winter'], growTime: 4, pricePerUnit: 1.50, seedPrice: 3,
                yieldMin: 1, yieldMax: 2, unit: 'kg', description: '1-2 kg por planta'
            },
            alcachofa: {
                name: 'Alcachofa', emoji: 'üåø', seasons: ['autumn', 'winter', 'spring'], growTime: 6, pricePerUnit: 2.00, seedPrice: 8,
                yieldMin: 10, yieldMax: 20, unit: 'unid', description: '10-20 alcachofas por planta'
            },
            esparrago: {
                name: 'Esp√°rrago', emoji: 'üåø', seasons: ['spring'], growTime: 5, pricePerUnit: 4.00, seedPrice: 10,
                yieldMin: 15, yieldMax: 25, unit: 'unid', description: '15-25 esp√°rragos'
            },
            patata: {
                name: 'Patata', emoji: 'ü•î', seasons: ['spring', 'summer'], growTime: 5, pricePerUnit: 0.40, seedPrice: 3,
                yieldMin: 8, yieldMax: 15, unit: 'kg', description: '8-15 kg por planta'
            },
            ajo: {
                name: 'Ajo', emoji: 'üßÑ', seasons: ['autumn'], growTime: 8, pricePerUnit: 3.00, seedPrice: 4,
                yieldMin: 8, yieldMax: 12, unit: 'unid', description: '8-12 cabezas de ajo'
            },

            // Frutas de √°rbol (unidades)
            naranja: {
                name: 'Naranja', emoji: 'üçä', seasons: ['winter', 'spring'], growTime: 10, pricePerUnit: 0.30, seedPrice: 15,
                yieldMin: 80, yieldMax: 150, unit: 'unid', description: '80-150 naranjas por √°rbol'
            },
            limon: {
                name: 'Lim√≥n', emoji: 'üçã', seasons: ['winter', 'spring'], growTime: 10, pricePerUnit: 0.35, seedPrice: 15,
                yieldMin: 60, yieldMax: 120, unit: 'unid', description: '60-120 limones por √°rbol'
            },
            manzana: {
                name: 'Manzana', emoji: 'üçé', seasons: ['autumn'], growTime: 8, pricePerUnit: 0.40, seedPrice: 12,
                yieldMin: 100, yieldMax: 200, unit: 'unid', description: '100-200 manzanas por √°rbol'
            },
            pera: {
                name: 'Pera', emoji: 'üçê', seasons: ['summer', 'autumn'], growTime: 7, pricePerUnit: 0.50, seedPrice: 12,
                yieldMin: 80, yieldMax: 150, unit: 'unid', description: '80-150 peras por √°rbol'
            },
            melocoton: {
                name: 'Melocot√≥n', emoji: 'üçë', seasons: ['summer'], growTime: 6, pricePerUnit: 0.60, seedPrice: 14,
                yieldMin: 60, yieldMax: 100, unit: 'unid', description: '60-100 melocotones'
            },
            cereza: {
                name: 'Cereza', emoji: 'üçí', seasons: ['spring'], growTime: 5, pricePerUnit: 3.50, seedPrice: 20,
                yieldMin: 8, yieldMax: 15, unit: 'kg', description: '8-15 kg por √°rbol'
            },
            higo: {
                name: 'Higo', emoji: 'ü´ê', seasons: ['summer', 'autumn'], growTime: 6, pricePerUnit: 2.50, seedPrice: 10,
                yieldMin: 30, yieldMax: 60, unit: 'unid', description: '30-60 higos por √°rbol'
            },
            albaricoque: {
                name: 'Albaricoque', emoji: 'üçë', seasons: ['spring', 'summer'], growTime: 5, pricePerUnit: 1.20, seedPrice: 12,
                yieldMin: 50, yieldMax: 100, unit: 'unid', description: '50-100 albaricoques'
            },
            kaki: {
                name: 'Kaki', emoji: 'üçä', seasons: ['autumn'], growTime: 8, pricePerUnit: 1.50, seedPrice: 15,
                yieldMin: 60, yieldMax: 100, unit: 'unid', description: '60-100 kakis por √°rbol'
            },
            kiwi: {
                name: 'Kiwi', emoji: 'ü•ù', seasons: ['autumn', 'winter'], growTime: 9, pricePerUnit: 1.80, seedPrice: 18,
                yieldMin: 40, yieldMax: 80, unit: 'unid', description: '40-80 kiwis por planta'
            },

            // Frutas peque√±as
            fresa: {
                name: 'Fresa', emoji: 'üçì', seasons: ['spring'], growTime: 3, pricePerUnit: 4.00, seedPrice: 8,
                yieldMin: 0.5, yieldMax: 1, unit: 'kg', description: '0.5-1 kg por planta'
            },
            arandano: {
                name: 'Ar√°ndano', emoji: 'ü´ê', seasons: ['summer'], growTime: 5, pricePerUnit: 8.00, seedPrice: 15,
                yieldMin: 2, yieldMax: 5, unit: 'kg', description: '2-5 kg por arbusto'
            },
            frambuesa: {
                name: 'Frambuesa', emoji: 'üçá', seasons: ['summer'], growTime: 4, pricePerUnit: 7.00, seedPrice: 12,
                yieldMin: 1, yieldMax: 3, unit: 'kg', description: '1-3 kg por planta'
            },

            // Uva y vino
            uva: {
                name: 'Uva', emoji: 'üçá', seasons: ['summer', 'autumn'], growTime: 7, pricePerUnit: 1.50, seedPrice: 10,
                yieldMin: 8, yieldMax: 15, unit: 'kg', description: '8-15 kg por vid'
            },

            // Melones
            melon: {
                name: 'Mel√≥n', emoji: 'üçà', seasons: ['summer'], growTime: 5, pricePerUnit: 1.20, seedPrice: 5,
                yieldMin: 2, yieldMax: 4, unit: 'unid', description: '2-4 melones por planta'
            },
            sandia: {
                name: 'Sand√≠a', emoji: 'üçâ', seasons: ['summer'], growTime: 5, pricePerUnit: 0.80, seedPrice: 4,
                yieldMin: 1, yieldMax: 3, unit: 'unid', description: '1-3 sand√≠as grandes'
            },

            // Tropicales
            aguacate: {
                name: 'Aguacate', emoji: 'ü•ë', seasons: ['winter', 'spring'], growTime: 12, pricePerUnit: 2.50, seedPrice: 30,
                yieldMin: 60, yieldMax: 150, unit: 'unid', description: '60-150 aguacates por √°rbol'
            },
            mango: {
                name: 'Mango', emoji: 'ü•≠', seasons: ['summer', 'autumn'], growTime: 14, pricePerUnit: 3.00, seedPrice: 40,
                yieldMin: 40, yieldMax: 100, unit: 'unid', description: '40-100 mangos por √°rbol'
            },

            // Legumbres
            lentejas: {
                name: 'Lentejas', emoji: 'ü´ò', seasons: ['autumn', 'winter'], growTime: 6, pricePerUnit: 2.00, seedPrice: 4,
                yieldMin: 1, yieldMax: 2, unit: 'kg', description: '1-2 kg por m¬≤'
            },
            garbanzos: {
                name: 'Garbanzos', emoji: 'ü´ò', seasons: ['spring'], growTime: 7, pricePerUnit: 2.50, seedPrice: 5,
                yieldMin: 0.8, yieldMax: 1.5, unit: 'kg', description: '0.8-1.5 kg por m¬≤'
            },
            alubia: {
                name: 'Alubia', emoji: 'ü´ò', seasons: ['spring', 'summer'], growTime: 5, pricePerUnit: 3.00, seedPrice: 6,
                yieldMin: 1, yieldMax: 2, unit: 'kg', description: '1-2 kg por m¬≤'
            },

            // Frutos secos
            almendra: {
                name: 'Almendra', emoji: 'üå∞', seasons: ['summer', 'autumn'], growTime: 10, pricePerUnit: 6.00, seedPrice: 20,
                yieldMin: 5, yieldMax: 12, unit: 'kg', description: '5-12 kg por √°rbol'
            },
            avellana: {
                name: 'Avellana', emoji: 'üå∞', seasons: ['autumn'], growTime: 9, pricePerUnit: 5.00, seedPrice: 18,
                yieldMin: 4, yieldMax: 10, unit: 'kg', description: '4-10 kg por √°rbol'
            },

            // Especiales
            azafran: {
                name: 'Azafr√°n', emoji: 'üå∏', seasons: ['autumn'], growTime: 8, pricePerUnit: 200.00, seedPrice: 50,
                yieldMin: 0.5, yieldMax: 1.5, unit: 'g', description: '0.5-1.5 g por m¬≤ (¬°Oro rojo!)'
            },
            olivo: {
                name: 'Aceitunas', emoji: 'ü´í', seasons: ['autumn', 'winter'], growTime: 12, pricePerUnit: 1.50, seedPrice: 25,
                yieldMin: 15, yieldMax: 30, unit: 'kg', description: '15-30 kg por olivo'
            },
            girasol: {
                name: 'Girasol', emoji: 'üåª', seasons: ['summer'], growTime: 5, pricePerUnit: 0.80, seedPrice: 3,
                yieldMin: 0.5, yieldMax: 1, unit: 'kg', description: '0.5-1 kg de pipas'
            },
            champi√±on: {
                name: 'Champi√±√≥n', emoji: 'üçÑ', seasons: ['spring', 'autumn', 'winter'], growTime: 2, pricePerUnit: 3.00, seedPrice: 5,
                yieldMin: 2, yieldMax: 4, unit: 'kg', description: '2-4 kg por cultivo'
            },
            algodon: {
                name: 'Algod√≥n', emoji: '‚òÅÔ∏è', seasons: ['summer'], growTime: 8, pricePerUnit: 1.80, seedPrice: 8,
                yieldMin: 2, yieldMax: 4, unit: 'kg', description: '2-4 kg por planta'
            },
            remolacha: {
                name: 'Remolacha', emoji: 'ü´ê', seasons: ['spring', 'summer'], growTime: 5, pricePerUnit: 0.60, seedPrice: 3,
                yieldMin: 3, yieldMax: 6, unit: 'kg', description: '3-6 kg por m¬≤'
            }
        };

        // Herramientas
        const tools = {
            azada: { name: 'Azada B√°sica', emoji: '‚õèÔ∏è', price: 0, effect: 'Permite cultivar' },
            regadera: { name: 'Regadera Pro', emoji: 'üöø', price: 200, effect: '-50% coste de riego' },
            tractor: { name: 'Tractor', emoji: 'üöú', price: 3000, effect: '-20% tiempo crecimiento' },
            invernadero: { name: 'Invernadero', emoji: 'üè†', price: 8000, effect: 'Ignora temporadas' },
            sistemaRiego: { name: 'Riego Autom√°tico', emoji: 'üíß', price: 5000, effect: 'Riego diario gratis' }
        };

        // Equipos electrocultura
        const electroEquipment = {
            copperAntenna: { name: 'Antena de Cobre', emoji: 'üì°', price: 1000, effect: '+20% velocidad', desc: 'Captura electricidad atmosf√©rica' },
            magneticPoles: { name: 'Polos Magn√©ticos', emoji: 'üß≤', price: 2500, effect: '+30% rendimiento', desc: 'Mejora absorci√≥n de nutrientes' },
            pyramidStructure: { name: 'Pir√°mide Energ√©tica', emoji: 'üî∫', price: 5000, effect: '+40% precio venta', desc: 'Concentra energ√≠a c√≥smica' },
            electroStimulator: { name: 'Electroestimulador', emoji: '‚ö°', price: 8000, effect: '-3 d√≠as crecimiento', desc: 'Pulsos el√©ctricos a ra√≠ces' },
            cosmicAntenna: { name: 'Antena C√≥smica', emoji: 'üõ∏', price: 20000, effect: '¬°Todo x2!', desc: 'Tecnolog√≠a suprema' }
        };

        let minigameInterval = null;
        let minigameTimeout = null;
        let minigameScore = 0;
        let minigameType = null;

        // ============ INICIALIZACI√ìN ============
        function startGame() {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameContainer').classList.remove('hidden');
            initGame();
        }

        function initGame() {
            initFarmForRegion('castillalamancha');
            gameData.inventory.seeds = { trigo: 5, cebada: 5, azafran: 2, uva: 3 };
            updateUI();
            renderFarm();
            renderShop();
            renderElectroculture();
        }

        function initFarmForRegion(regionId) {
            if (!gameData.farms[regionId]) {
                const region = regions[regionId];
                const plots = [];
                for (let i = 0; i < region.farmSize; i++) {
                    plots.push({ planted: null, daysGrown: 0, watered: false, ready: false, yieldAmount: 0, plowed: false });
                }
                gameData.farms[regionId] = { plots };
            }
        }

        // ============ NAVEGACI√ìN ============
        function showView(view) {
            ['mapView', 'farmView', 'minigameView', 'shopView', 'electrocultureView', 'inventoryView'].forEach(v => {
                document.getElementById(v)?.classList.add('hidden');
            });
            document.getElementById(view + 'View').classList.remove('hidden');

            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('ring-2', 'ring-yellow-400'));
            const activeBtn = document.getElementById('nav' + view.charAt(0).toUpperCase() + view.slice(1));
            if (activeBtn) activeBtn.classList.add('ring-2', 'ring-yellow-400');

            if (view === 'farm') {
                updateFarmBackground();
                renderFarm();
                renderSeeds();
                renderQuickInventory();
            } else if (view === 'shop') renderShop();
            else if (view === 'electroculture') renderElectroculture();
            else if (view === 'inventory') renderInventory();
        }

        function updateFarmBackground() {
            const farm = document.getElementById('farmFullscreen');
            farm.classList.remove('spring', 'summer', 'autumn', 'winter');
            farm.classList.add(gameData.season);
        }

        // ============ UI ============
        function updateUI() {
            document.getElementById('money').textContent = Math.floor(gameData.money);
            document.getElementById('energy').textContent = Math.floor(gameData.energy);
            document.getElementById('level').textContent = gameData.level;

            const xpPercent = (gameData.xp / gameData.xpNeeded) * 100;
            document.getElementById('xpBarHeader').style.width = `${xpPercent}%`;
            document.getElementById('xpText').textContent = `${gameData.xp}/${gameData.xpNeeded}`;

            if (document.getElementById('currentDay')) {
                document.getElementById('currentDay').textContent = gameData.day;
                document.getElementById('currentYear').textContent = gameData.year;
            }

            const seasonData = {
                spring: { emoji: 'üå∏', name: 'Primavera' }, summer: { emoji: '‚òÄÔ∏è', name: 'Verano' },
                autumn: { emoji: 'üçÇ', name: 'Oto√±o' }, winter: { emoji: '‚ùÑÔ∏è', name: 'Invierno' }
            };
            const season = seasonData[gameData.season];

            document.getElementById('seasonIndicator').textContent = `${season.emoji} ${season.name}`;
            if (document.getElementById('currentSeasonText'))
                document.getElementById('currentSeasonText').textContent = `${season.emoji} ${season.name}`;

            if (document.getElementById('xpBar')) {
                document.getElementById('xpBar').style.width = `${xpPercent}%`;
                document.getElementById('levelProgress').textContent = gameData.level;
                document.getElementById('xpProgress').textContent = gameData.xp;
                document.getElementById('xpNeededProgress').textContent = gameData.xpNeeded;
            }

            document.getElementById('unlockedCount').textContent = `${gameData.unlockedRegions.length} / ${Object.keys(regions).length}`;

            Object.keys(regions).forEach(id => {
                const el = document.getElementById('region-' + id);
                if (el) {
                    el.classList.remove('locked', 'current');
                    if (!gameData.unlockedRegions.includes(id)) el.classList.add('locked');
                    if (id === gameData.currentRegion) el.classList.add('current');
                }
            });

            const hasElectro = Object.values(gameData.electroculture).some(v => v);
            const electroStatus = document.getElementById('electrocultureStatus');
            if (electroStatus) {
                electroStatus.innerHTML = hasElectro
                    ? '<span class="text-green-300">‚ö° Electrocultura ACTIVA</span>'
                    : '<span class="text-gray-400">‚ö° Sin electrocultura</span>';
                electroStatus.className = hasElectro ? 'bg-green-800 px-3 py-1 rounded-lg text-sm' : 'bg-gray-700 px-3 py-1 rounded-lg text-sm';
            }

            if (document.getElementById('farmRegionTitle'))
                document.getElementById('farmRegionTitle').textContent = `üåæ Granja de ${regions[gameData.currentRegion].name}`;
            if (document.getElementById('shopRegionName'))
                document.getElementById('shopRegionName').textContent = regions[gameData.currentRegion].name;
            if (document.getElementById('plotCount'))
                document.getElementById('plotCount').textContent = gameData.farms[gameData.currentRegion]?.plots.length || 0;
        }

        // ============ GRANJA ============
        function renderFarm() {
            const grid = document.getElementById('farmGrid');
            if (!grid) return;
            grid.innerHTML = '';

            const farm = gameData.farms[gameData.currentRegion];
            if (!farm) return;

            farm.plots.forEach((plot, index) => {
                const cell = document.createElement('div');
                cell.className = 'farm-plot w-16 h-16 sm:w-18 sm:h-18 md:w-20 md:h-20 flex items-center justify-center cursor-pointer relative transition-all duration-300';

                if (plot.planted) {
                    const crop = crops[plot.planted];
                    const progress = Math.min(plot.daysGrown / getGrowTime(plot.planted), 1);

                    cell.classList.add('planted');
                    if (plot.watered) cell.classList.add('watered');

                    if (plot.ready) {
                        cell.classList.add('ready');
                        const hasElectro = Object.values(gameData.electroculture).some(v => v);
                        cell.innerHTML = `
                            <div class="plant-icon plant-sway text-3xl md:text-4xl ${hasElectro ? 'electro-active' : ''}">${crop.emoji}</div>
                            <div class="yield-badge">${plot.yieldAmount.toFixed(1)}${crop.unit}</div>
                        `;
                        cell.title = `${crop.name} - ¬°LISTO! ${plot.yieldAmount.toFixed(1)} ${crop.unit}`;
                        cell.onclick = () => startFullHarvest(index);
                    } else {
                        const stage = progress < 0.25 ? 'üå±' : progress < 0.5 ? 'üåø' : progress < 0.75 ? 'ü™¥' : crop.emoji;
                        cell.innerHTML = `
                            <div class="plant-icon plant-sway text-2xl md:text-3xl">${stage}</div>
                            <div class="growth-bar"><div class="growth-bar-fill" style="width: ${progress * 100}%"></div></div>
                        `;
                        cell.title = `${crop.name} - ${Math.floor(progress * 100)}% (${Math.ceil(getGrowTime(plot.planted) - plot.daysGrown)} d√≠as restantes)`;

                        // Interaction: Spray to water
                        cell.onmousedown = (e) => startSpraying(index, e);
                        cell.onmouseup = stopSpraying;
                        cell.onmouseleave = stopSpraying;
                    }
                } else if (plot.plowed) {
                    cell.classList.add('plowed');
                    cell.innerHTML = '<span class="text-amber-200/50 text-3xl font-bold">‚ú®</span>';
                    cell.title = 'Parcela arada - Clic para plantar';
                    cell.onclick = () => openPlantModal(index);
                } else {
                    cell.classList.add('unplowed');
                    cell.innerHTML = '<span class="text-white/20 text-3xl font-bold">üçÇ</span>';
                    cell.title = 'Tierra sin arar - Mant√©n 2s para arar';

                    // Interaction: Hold to plow
                    cell.onmousedown = () => startPlowing(index);
                    cell.onmouseup = stopPlowing;
                    cell.onmouseleave = stopPlowing;
                }

                grid.appendChild(cell);
            });
        }

        function renderSeeds() {
            const list = document.getElementById('seedList');
            if (!list) return;
            list.innerHTML = '';

            const regionCrops = regions[gameData.currentRegion].crops;
            let hasSeeds = false;

            Object.entries(gameData.inventory.seeds).forEach(([seedId, qty]) => {
                if (qty > 0 && regionCrops.includes(seedId)) {
                    hasSeeds = true;
                    const crop = crops[seedId];
                    const inSeason = crop.seasons.includes(gameData.season) || gameData.inventory.tools.invernadero;

                    const item = document.createElement('div');
                    item.className = `p-2 rounded-lg flex items-center gap-2 ${inSeason ? 'bg-green-800/80' : 'bg-gray-700/80'}`;
                    item.innerHTML = `
                        <span class="text-xl">${crop.emoji}</span>
                        <div class="flex-1 min-w-0">
                            <p class="text-white text-xs font-bold truncate">${crop.name}</p>
                            <p class="text-xs ${inSeason ? 'text-green-300' : 'text-red-300'}">${inSeason ? '‚úì En temporada' : '‚úó Fuera temp.'}</p>
                        </div>
                        <span class="text-yellow-300 font-bold">${qty}</span>
                    `;
                    list.appendChild(item);
                }
            });

            if (!hasSeeds) list.innerHTML = '<p class="text-gray-400 text-xs text-center py-2">Sin semillas</p>';
        }

        function renderQuickInventory() {
            const container = document.getElementById('quickInventory');
            if (!container) return;
            container.innerHTML = '';

            const harvests = Object.entries(gameData.inventory.harvests).filter(([_, q]) => q > 0);
            if (harvests.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-xs">Vac√≠o</p>';
                document.getElementById('totalHarvestValue').textContent = '0';
                return;
            }

            let total = 0;
            harvests.slice(0, 6).forEach(([cropId, qty]) => {
                const crop = crops[cropId];
                const value = qty * crop.pricePerUnit * getPriceMultiplier();
                total += value;
                const item = document.createElement('div');
                item.className = 'flex items-center gap-1 text-white';
                item.innerHTML = `<span>${crop.emoji}</span><span class="truncate flex-1 text-xs">${crop.name}</span><span class="text-yellow-300 text-xs">${qty.toFixed(1)}${crop.unit}</span>`;
                container.appendChild(item);
            });

            document.getElementById('totalHarvestValue').textContent = Math.floor(total);
        }

        function openPlantModal(index) {
            gameData.selectedPlotIndex = index;
            const modal = document.getElementById('plantModal');
            const container = document.getElementById('plantModalSeeds');
            container.innerHTML = '';

            const regionCrops = regions[gameData.currentRegion].crops;
            let hasSeeds = false;

            Object.entries(gameData.inventory.seeds).forEach(([seedId, qty]) => {
                if (qty > 0 && regionCrops.includes(seedId)) {
                    hasSeeds = true;
                    const crop = crops[seedId];
                    const inSeason = crop.seasons.includes(gameData.season) || gameData.inventory.tools.invernadero;

                    const btn = document.createElement('button');
                    btn.className = `w-full p-3 rounded-lg ${inSeason ? 'bg-green-700 hover:bg-green-600' : 'bg-gray-700 opacity-60 cursor-not-allowed'} flex items-center gap-3 transition-all`;
                    btn.disabled = !inSeason;
                    btn.innerHTML = `
                        <span class="text-3xl">${crop.emoji}</span>
                        <div class="flex-1 text-left">
                            <p class="text-white font-bold">${crop.name}</p>
                            <p class="text-green-300 text-xs">üå± ${crop.description}</p>
                            <p class="text-gray-300 text-xs">‚è±Ô∏è ${getGrowTime(seedId)} d√≠as | üí∞ ${crop.pricePerUnit}/${crop.unit}</p>
                        </div>
                        <div class="text-right">
                            <span class="text-yellow-300 font-bold text-lg">${qty}</span>
                            <p class="text-gray-400 text-xs">semillas</p>
                        </div>
                    `;
                    btn.onclick = () => plantSeed(seedId);
                    container.appendChild(btn);
                }
            });

            if (!hasSeeds) container.innerHTML = '<p class="text-gray-400 text-center py-8">No tienes semillas para esta regi√≥n. ¬°Ve a la tienda!</p>';
            modal.classList.remove('hidden');
        }

        function closePlantModal() {
            document.getElementById('plantModal').classList.add('hidden');
            gameData.selectedPlotIndex = null;
        }

        function plantSeed(seedId) {
            if (gameData.energy < 5) {
                alert('¬°No tienes suficiente energ√≠a! Juega minijuegos o descansa.');
                return;
            }

            const farm = gameData.farms[gameData.currentRegion];
            const crop = crops[seedId];

            // Calcular rendimiento con electrocultura
            let yieldAmount = crop.yieldMin + Math.random() * (crop.yieldMax - crop.yieldMin);
            yieldAmount *= getYieldMultiplier();

            farm.plots[gameData.selectedPlotIndex] = {
                planted: seedId,
                daysGrown: 0,
                watered: false,
                ready: false,
                yieldAmount: yieldAmount
            };

            gameData.inventory.seeds[seedId]--;
            if (gameData.inventory.seeds[seedId] <= 0) delete gameData.inventory.seeds[seedId];

            gameData.energy -= 5;
            closePlantModal();
            renderFarm();
            renderSeeds();
            updateUI();
        }

        function interactPlot(index) {
            const farm = gameData.farms[gameData.currentRegion];
            const plot = farm.plots[index];
            if (!plot.planted) return;

            if (plot.ready) harvestPlot(index);
            else if (!plot.watered && gameData.energy >= 2) waterPlot(index);
        }

        function waterPlot(index) {
            const cost = gameData.inventory.tools.regadera ? 1 : 2;
            if (gameData.energy < cost) return;

            gameData.farms[gameData.currentRegion].plots[index].watered = true;
            gameData.energy -= cost;
            renderFarm();
            updateUI();
        }

        function waterAll() {
            const cost = gameData.inventory.tools.regadera ? 5 : 10;
            if (gameData.energy < cost) {
                alert('¬°No tienes suficiente energ√≠a!');
                return;
            }

            gameData.farms[gameData.currentRegion].plots.forEach(plot => {
                if (plot.planted && !plot.ready) plot.watered = true;
            });

            gameData.energy -= cost;
            renderFarm();
            updateUI();
        }

        function harvestPlot(index) {
            const farm = gameData.farms[gameData.currentRegion];
            const plot = farm.plots[index];
            if (!plot.ready) return;

            const cropId = plot.planted;
            const crop = crops[cropId];

            if (!gameData.inventory.harvests[cropId]) gameData.inventory.harvests[cropId] = 0;
            gameData.inventory.harvests[cropId] += plot.yieldAmount;

            const xpGain = Math.floor(plot.yieldAmount * crop.pricePerUnit);
            gainXP(xpGain);

            farm.plots[index] = { planted: null, daysGrown: 0, watered: false, ready: false, yieldAmount: 0 };

            renderFarm();
            renderQuickInventory();
            updateUI();
        }

        function harvestAll() {
            const farm = gameData.farms[gameData.currentRegion];
            farm.plots.forEach((plot, i) => {
                if (plot.ready) harvestPlot(i);
            });
        }

        function expandFarm() {
            if (gameData.money < 500) {
                alert('¬°Necesitas 500üí∞ para expandir!');
                return;
            }

            gameData.money -= 500;
            const farm = gameData.farms[gameData.currentRegion];
            for (let i = 0; i < 4; i++) {
                farm.plots.push({ planted: null, daysGrown: 0, watered: false, ready: false, yieldAmount: 0 });
            }

            renderFarm();
            updateUI();
        }

        function advanceDay() {
            gameData.day++;

            Object.values(gameData.farms).forEach(farm => {
                farm.plots.forEach(plot => {
                    if (plot.planted && !plot.ready) {
                        plot.daysGrown += plot.watered ? 1.5 : 1;
                        plot.watered = false;
                        if (plot.daysGrown >= getGrowTime(plot.planted)) plot.ready = true;
                    }
                });

                if (gameData.inventory.tools.sistemaRiego) {
                    farm.plots.forEach(plot => {
                        if (plot.planted && !plot.ready) plot.watered = true;
                    });
                }
            });

            if (gameData.day % 30 === 0) {
                const seasons = ['spring', 'summer', 'autumn', 'winter'];
                const idx = seasons.indexOf(gameData.season);
                gameData.season = seasons[(idx + 1) % 4];
                if (gameData.season === 'spring') gameData.year++;
            }

            gameData.energy = Math.min(gameData.maxEnergy, gameData.energy + 35);

            updateFarmBackground();
            renderFarm();
            updateUI();
        }

        // ============ C√ÅLCULOS ============
        function getGrowTime(cropId) {
            let time = crops[cropId].growTime;
            if (gameData.electroculture.electroStimulator) time -= 3;
            if (gameData.electroculture.copperAntenna) time *= 0.8;
            if (gameData.electroculture.cosmicAntenna) time *= 0.5;
            if (gameData.inventory.tools.tractor) time *= 0.8;
            return Math.max(1, Math.floor(time));
        }

        function getYieldMultiplier() {
            let mult = 1;
            if (gameData.electroculture.magneticPoles) mult += 0.3;
            if (gameData.electroculture.cosmicAntenna) mult += 0.5;
            return mult;
        }

        function getPriceMultiplier() {
            let mult = 1;
            if (gameData.electroculture.pyramidStructure) mult += 0.4;
            if (gameData.electroculture.cosmicAntenna) mult += 0.4;
            return mult;
        }

        function gainXP(amount) {
            gameData.xp += amount;
            while (gameData.xp >= gameData.xpNeeded) {
                gameData.xp -= gameData.xpNeeded;
                gameData.level++;
                gameData.xpNeeded = Math.floor(gameData.xpNeeded * 1.5);

                const regionOrder = Object.keys(regions);
                if (gameData.level <= regionOrder.length) {
                    const newRegion = regionOrder[gameData.level - 1];
                    if (!gameData.unlockedRegions.includes(newRegion)) {
                        gameData.unlockedRegions.push(newRegion);
                        initFarmForRegion(newRegion);
                        alert(`üéâ ¬°Nivel ${gameData.level}! Desbloqueaste ${regions[newRegion].name}!`);
                    }
                }
            }
            updateUI();
        }

        // ============ INVENTARIO ============
        function renderInventory() {
            const grid = document.getElementById('inventoryGrid');
            const sell = document.getElementById('sellInventory');
            if (!grid || !sell) return;

            const harvests = Object.entries(gameData.inventory.harvests).filter(([_, q]) => q > 0);

            if (harvests.length === 0) {
                grid.innerHTML = '<p class="text-gray-400 col-span-full text-center py-8">Sin cosechas a√∫n</p>';
                sell.innerHTML = '<p class="text-gray-400 text-center py-8">Cosecha productos primero</p>';
                document.getElementById('totalInventoryValue').textContent = '0 üí∞';
                return;
            }

            grid.innerHTML = '';
            sell.innerHTML = '';
            let total = 0;

            harvests.forEach(([cropId, qty]) => {
                const crop = crops[cropId];
                const price = crop.pricePerUnit * getPriceMultiplier();
                const value = qty * price;
                total += value;

                const item = document.createElement('div');
                item.className = 'inventory-item';
                item.innerHTML = `
                    <span class="text-3xl">${crop.emoji}</span>
                    <p class="text-amber-900 font-bold text-sm">${crop.name}</p>
                    <p class="text-amber-700 text-xs">${qty.toFixed(1)} ${crop.unit}</p>
                    <p class="text-green-700 font-bold text-xs">${Math.floor(value)}üí∞</p>
                `;
                grid.appendChild(item);

                const sellItem = document.createElement('div');
                sellItem.className = 'bg-green-800/50 p-3 rounded-lg flex items-center gap-3';
                sellItem.innerHTML = `
                    <span class="text-2xl">${crop.emoji}</span>
                    <div class="flex-1">
                        <p class="text-white font-bold">${crop.name}</p>
                        <p class="text-green-300 text-sm">${qty.toFixed(1)} ${crop.unit} √ó ${price.toFixed(2)}üí∞</p>
                    </div>
                    <button onclick="sellHarvest('${cropId}')" class="bg-yellow-600 hover:bg-yellow-500 text-white px-4 py-2 rounded-lg font-bold">
                        ${Math.floor(value)}üí∞
                    </button>
                `;
                sell.appendChild(sellItem);
            });

            document.getElementById('totalInventoryValue').textContent = `${Math.floor(total)} üí∞`;
        }

        function sellHarvest(cropId) {
            const qty = gameData.inventory.harvests[cropId];
            if (!qty || qty <= 0) return;

            const crop = crops[cropId];
            const price = Math.floor(qty * crop.pricePerUnit * getPriceMultiplier());
            gameData.money += price;
            delete gameData.inventory.harvests[cropId];

            updateUI();
            renderInventory();
            renderQuickInventory();
        }

        function sellAll() {
            let total = 0;
            Object.entries(gameData.inventory.harvests).forEach(([cropId, qty]) => {
                if (qty > 0) {
                    const crop = crops[cropId];
                    total += qty * crop.pricePerUnit * getPriceMultiplier();
                }
            });
            gameData.money += Math.floor(total);
            gameData.inventory.harvests = {};

            updateUI();
            renderInventory();
            renderQuickInventory();
        }

        // ============ REGIONES ============
        function selectRegion(regionId) {
            const region = regions[regionId];
            const unlocked = gameData.unlockedRegions.includes(regionId);

            const content = document.getElementById('regionModalContent');
            content.innerHTML = `
                <div class="text-center mb-4">
                    <span class="text-6xl">${region.emoji}</span>
                    <h2 class="title-font text-2xl text-yellow-300 mt-2">${region.name}</h2>
                </div>
                <div class="bg-black/30 rounded-xl p-4 mb-4 space-y-2">
                    <p class="text-amber-300">‚≠ê Nivel requerido: <span class="text-white font-bold">${region.level}</span></p>
                    <p class="text-amber-300">üì¶ Parcelas: <span class="text-white font-bold">${region.farmSize}</span></p>
                    <p class="text-amber-300">${unlocked ? 'üîì Desbloqueada' : 'üîí Bloqueada'}</p>
                </div>
                <div class="mb-4">
                    <p class="text-yellow-300 font-bold text-sm mb-2">üå± Cultivos de la regi√≥n:</p>
                    <div class="flex flex-wrap gap-2">
                        ${region.crops.map(c => crops[c] ? `<span class="bg-green-800/60 px-2 py-1 rounded text-white text-xs flex items-center gap-1">${crops[c].emoji} ${crops[c].name}</span>` : '').join('')}
                    </div>
                </div>
                ${unlocked ? `
                    <button onclick="travelToRegion('${regionId}')" class="w-full bg-green-600 hover:bg-green-500 text-white py-3 rounded-xl font-bold text-lg transition-all">
                        üöú Ir a mi granja
                    </button>
                ` : `
                    <div class="bg-red-900/50 p-4 rounded-xl text-center">
                        <p class="text-red-300">Necesitas nivel ${region.level}</p>
                        <p class="text-gray-400 text-sm">Tu nivel actual: ${gameData.level}</p>
                    </div>
                `}
            `;

            document.getElementById('regionModal').classList.remove('hidden');
        }

        function closeRegionModal() { document.getElementById('regionModal').classList.add('hidden'); }

        function travelToRegion(regionId) {
            gameData.currentRegion = regionId;
            initFarmForRegion(regionId);
            closeRegionModal();
            showView('farm');
            updateUI();
        }

        // ============ TIENDA ============
        function renderShop() {
            renderShopSeeds();
            renderShopTools();
            renderShopElectro();
        }

        function renderShopSeeds() {
            const container = document.getElementById('shopSeeds');
            if (!container) return;
            container.innerHTML = '';

            regions[gameData.currentRegion].crops.forEach(cropId => {
                const crop = crops[cropId];
                if (!crop) return;

                const inSeason = crop.seasons.includes(gameData.season);
                const item = document.createElement('div');
                item.className = `p-3 rounded-lg ${inSeason ? 'bg-green-800/60' : 'bg-gray-700/60'}`;
                item.innerHTML = `
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-2xl">${crop.emoji}</span>
                        <div class="flex-1">
                            <p class="text-white font-bold text-sm">${crop.name}</p>
                            <p class="text-xs ${inSeason ? 'text-green-300' : 'text-gray-400'}">${inSeason ? '‚úì En temporada' : 'Fuera de temporada'}</p>
                        </div>
                    </div>
                    <p class="text-gray-300 text-xs mb-2">üìä Rinde: ${crop.description}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-yellow-300 font-bold">${crop.seedPrice}üí∞</span>
                        <button onclick="buySeed('${cropId}')" class="bg-yellow-600 hover:bg-yellow-500 text-white px-3 py-1 rounded text-sm font-bold transition-all">
                            Comprar
                        </button>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function renderShopTools() {
            const container = document.getElementById('shopTools');
            if (!container) return;
            container.innerHTML = '';

            Object.entries(tools).forEach(([id, tool]) => {
                if (id === 'azada') return;
                const owned = gameData.inventory.tools[id];

                const item = document.createElement('div');
                item.className = `p-3 rounded-lg ${owned ? 'bg-gray-700' : 'bg-blue-800/50'}`;
                item.innerHTML = `
                    <div class="flex items-center gap-2">
                        <span class="text-2xl">${tool.emoji}</span>
                        <div class="flex-1">
                            <p class="text-white font-bold text-sm">${tool.name}</p>
                            <p class="text-blue-300 text-xs">${tool.effect}</p>
                        </div>
                        ${owned ? '<span class="text-green-400">‚úì</span>' : `<button onclick="buyTool('${id}')" class="bg-yellow-600 hover:bg-yellow-500 text-white px-2 py-1 rounded text-sm font-bold">${tool.price}üí∞</button>`}
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function renderShopElectro() {
            const container = document.getElementById('shopElectro');
            if (!container) return;
            container.innerHTML = '';

            Object.entries(electroEquipment).forEach(([id, eq]) => {
                const owned = gameData.electroculture[id];

                const item = document.createElement('div');
                item.className = `p-3 rounded-lg ${owned ? 'bg-gray-700' : 'bg-purple-800/50'}`;
                item.innerHTML = `
                    <div class="flex items-center gap-2 mb-1">
                        <span class="text-2xl">${eq.emoji}</span>
                        <div class="flex-1">
                            <p class="text-white font-bold text-sm">${eq.name}</p>
                            <p class="text-yellow-300 text-xs">${eq.effect}</p>
                        </div>
                    </div>
                    <p class="text-gray-400 text-xs mb-2">${eq.desc}</p>
                    ${owned ? '<span class="text-green-400 text-sm">‚úì Instalado</span>' : `<button onclick="buyElectro('${id}')" class="w-full bg-yellow-600 hover:bg-yellow-500 text-white py-1 rounded text-sm font-bold">${eq.price}üí∞</button>`}
                `;
                container.appendChild(item);
            });
        }

        function buySeed(cropId) {
            const crop = crops[cropId];
            if (gameData.money < crop.seedPrice) {
                alert('¬°Dinero insuficiente!');
                return;
            }
            gameData.money -= crop.seedPrice;
            gameData.inventory.seeds[cropId] = (gameData.inventory.seeds[cropId] || 0) + 1;
            updateUI();
            renderSeeds();
        }

        function buyTool(toolId) {
            const tool = tools[toolId];
            if (gameData.money < tool.price) {
                alert('¬°Dinero insuficiente!');
                return;
            }
            gameData.money -= tool.price;
            gameData.inventory.tools[toolId] = true;
            updateUI();
            renderShopTools();
        }

        function buyElectro(eqId) {
            const eq = electroEquipment[eqId];
            if (gameData.money < eq.price) {
                alert('¬°Dinero insuficiente!');
                return;
            }
            gameData.money -= eq.price;
            gameData.electroculture[eqId] = true;
            updateUI();
            renderShopElectro();
            renderElectroculture();
        }

        // ============ ELECTROCULTURA ============
        function renderElectroculture() {
            const techContainer = document.getElementById('electroTechniques');
            const benefitsContainer = document.getElementById('activeBenefits');
            if (!techContainer || !benefitsContainer) return;

            techContainer.innerHTML = '';
            Object.entries(electroEquipment).forEach(([id, eq]) => {
                const owned = gameData.electroculture[id];
                const item = document.createElement('div');
                item.className = `p-4 rounded-xl ${owned ? 'bg-green-800/60 border-2 border-green-500' : 'bg-gray-800/60'}`;
                item.innerHTML = `
                    <div class="flex items-center gap-3">
                        <span class="text-3xl">${eq.emoji}</span>
                        <div class="flex-1">
                            <p class="text-white font-bold">${eq.name}</p>
                            <p class="text-yellow-300 text-sm">${eq.effect}</p>
                            <p class="text-gray-400 text-xs">${eq.desc}</p>
                        </div>
                        ${owned ? '<span class="text-green-400 text-2xl">‚ö°</span>' : `<button onclick="buyElectro('${id}')" class="bg-yellow-600 hover:bg-yellow-500 text-white px-4 py-2 rounded-lg font-bold">${eq.price}üí∞</button>`}
                    </div>
                `;
                techContainer.appendChild(item);
            });

            benefitsContainer.innerHTML = '';
            const benefits = [];
            if (gameData.electroculture.copperAntenna) benefits.push({ emoji: 'üì°', text: '+20% velocidad de crecimiento' });
            if (gameData.electroculture.magneticPoles) benefits.push({ emoji: 'üß≤', text: '+30% rendimiento de cosecha' });
            if (gameData.electroculture.pyramidStructure) benefits.push({ emoji: 'üî∫', text: '+40% precio de venta' });
            if (gameData.electroculture.electroStimulator) benefits.push({ emoji: '‚ö°', text: '-3 d√≠as de crecimiento' });
            if (gameData.electroculture.cosmicAntenna) benefits.push({ emoji: 'üõ∏', text: '¬°TODOS LOS BONUSES x2!' });

            if (benefits.length === 0) {
                benefitsContainer.innerHTML = '<p class="text-gray-400 text-sm">Ning√∫n equipo instalado</p>';
            } else {
                benefits.forEach(b => {
                    const item = document.createElement('div');
                    item.className = 'bg-green-700/50 p-3 rounded-lg flex items-center gap-3';
                    item.innerHTML = `<span class="text-2xl">${b.emoji}</span><span class="text-green-200">${b.text}</span>`;
                    benefitsContainer.appendChild(item);
                });
            }
        }

        // ============ MINIJUEGOS ============
        function startMinigame(type) {
            const costs = { catch: 10, pest: 5, water: 0, electric: 15 };
            if (gameData.energy < costs[type]) {
                alert('¬°Energ√≠a insuficiente!');
                return;
            }
            gameData.energy -= costs[type];
            updateUI();

            minigameType = type;
            minigameScore = 0;
            document.getElementById('minigameScore').textContent = '0';
            document.getElementById('minigameTimer').textContent = '30';

            const titles = { catch: 'üß∫ Atrapa la Cosecha', pest: 'üêõ Elimina Plagas', water: 'üíß Riego R√°pido', electric: '‚ö° Carga El√©ctrica' };
            document.getElementById('minigameTitle').textContent = titles[type];
            document.getElementById('minigameModal').classList.remove('hidden');

            const area = document.getElementById('minigameArea');
            area.innerHTML = '';

            if (type === 'catch') startCatchGame(area);
            else if (type === 'pest') startPestGame(area);
            else if (type === 'water') startWaterGame(area);
            else if (type === 'electric') startElectricGame(area);

            let time = 30;
            minigameInterval = setInterval(() => {
                time--;
                document.getElementById('minigameTimer').textContent = time;
                if (time <= 0) endMinigame();
            }, 1000);
        }

        function startCatchGame(area) {
            const fruits = ['üçé', 'üçä', 'üçã', 'üçá', 'üçì', 'üçë', 'üåΩ', 'ü•ï', 'üçÖ', 'ü•¨'];
            const bad = ['ü™®', 'üíÄ', 'üêõ'];

            function spawn() {
                const item = document.createElement('div');
                item.className = 'falling-item';
                const isBad = Math.random() < 0.2;
                item.textContent = isBad ? bad[Math.floor(Math.random() * bad.length)] : fruits[Math.floor(Math.random() * fruits.length)];
                item.dataset.bad = isBad;
                item.style.left = Math.random() * 85 + 5 + '%';
                item.style.top = '-40px';

                item.onclick = () => {
                    if (item.dataset.bad === 'true') {
                        minigameScore = Math.max(0, minigameScore - 5);
                    } else {
                        minigameScore += 5;
                        item.classList.add('caught');
                    }
                    document.getElementById('minigameScore').textContent = minigameScore;
                    setTimeout(() => item.remove(), 300);
                };

                area.appendChild(item);

                let pos = -40;
                const fall = setInterval(() => {
                    pos += 4;
                    item.style.top = pos + 'px';
                    if (pos > 400) {
                        clearInterval(fall);
                        item.remove();
                    }
                }, 40);
            }

            minigameTimeout = setInterval(spawn, 500);
        }

        function startPestGame(area) {
            const pests = ['üêõ', 'üêú', 'ü¶ó', 'üêå', 'ü™≤', 'ü¶ü'];

            function spawn() {
                const pest = document.createElement('div');
                pest.className = 'falling-item';
                pest.textContent = pests[Math.floor(Math.random() * pests.length)];
                pest.style.left = Math.random() * 85 + 5 + '%';
                pest.style.top = Math.random() * 80 + 10 + '%';
                pest.style.fontSize = '2.5rem';

                pest.onclick = () => {
                    minigameScore += 3;
                    document.getElementById('minigameScore').textContent = minigameScore;
                    pest.textContent = 'üí•';
                    setTimeout(() => pest.remove(), 150);
                };

                area.appendChild(pest);
                setTimeout(() => pest.remove(), 1500);
            }

            minigameTimeout = setInterval(spawn, 350);
        }

        function startWaterGame(area) {
            for (let i = 0; i < 15; i++) {
                const plant = document.createElement('div');
                plant.className = 'absolute text-4xl cursor-pointer transition-all hover:scale-125';
                plant.textContent = 'ü•Ä';
                plant.style.left = (8 + (i % 5) * 18) + '%';
                plant.style.top = (15 + Math.floor(i / 5) * 28) + '%';
                plant.dataset.watered = 'false';

                plant.onclick = () => {
                    if (plant.dataset.watered === 'false') {
                        plant.textContent = 'üå±';
                        plant.dataset.watered = 'true';
                        minigameScore += 5;
                        document.getElementById('minigameScore').textContent = minigameScore;
                    }
                };

                area.appendChild(plant);
            }
        }

        function startElectricGame(area) {
            for (let i = 0; i < 9; i++) {
                const node = document.createElement('div');
                node.className = 'absolute text-4xl cursor-pointer transition-all hover:scale-125';
                node.textContent = 'üî¥';
                node.style.left = (15 + (i % 3) * 30) + '%';
                node.style.top = (15 + Math.floor(i / 3) * 28) + '%';
                node.dataset.active = 'false';

                node.onclick = () => {
                    if (node.dataset.active === 'false') {
                        node.textContent = '‚ö°';
                        node.dataset.active = 'true';
                        minigameScore += 8;
                        document.getElementById('minigameScore').textContent = minigameScore;
                    }
                };

                area.appendChild(node);
            }
        }

        function endMinigame() {
            clearInterval(minigameInterval);
            clearInterval(minigameTimeout);

            let reward = '';
            if (minigameType === 'catch') {
                gameData.money += minigameScore;
                reward = `+${minigameScore}üí∞`;
            } else if (minigameType === 'pest') {
                gameData.money += minigameScore;
                reward = `+${minigameScore}üí∞`;
            } else if (minigameType === 'water') {
                const energy = Math.min(minigameScore / 2, 40);
                gameData.energy = Math.min(gameData.maxEnergy, gameData.energy + energy);
                reward = `+${Math.floor(energy)}‚ö°`;
            } else if (minigameType === 'electric') {
                gameData.energy = Math.min(gameData.maxEnergy, gameData.energy + 40);
                gameData.money += Math.floor(minigameScore / 3);
                reward = `+40‚ö° +${Math.floor(minigameScore / 3)}üí∞`;
            }

            setTimeout(() => {
                alert(`üéâ ¬°Juego terminado!\n\nPuntos: ${minigameScore}\nRecompensa: ${reward}`);
                closeMinigame();
                updateUI();
            }, 100);
        }

        function closeMinigame() {
            clearInterval(minigameInterval);
            clearInterval(minigameTimeout);
            document.getElementById('minigameModal').classList.add('hidden');
            document.getElementById('minigameArea').innerHTML = '';
        }

        // ============ GU√çA ============
        function nextGuideMessage() {
            gameData.guideMessageIndex = (gameData.guideMessageIndex + 1) % guideMessages.length;
            document.getElementById('guideText').textContent = guideMessages[gameData.guideMessageIndex];
        }

        function hideGuide() {
            document.getElementById('guidePanel').classList.add('hidden');
            document.getElementById('showGuideBtn').classList.remove('hidden');
        }

        function showGuide() {
            document.getElementById('guidePanel').classList.remove('hidden');
            document.getElementById('showGuideBtn').classList.add('hidden');
        }
        // ============ NUEVAS INTERACCIONES ============
        function startPlowing(index) {
            if (gameData.energy < 5) {
                alert('¬°Energ√≠a insuficiente!');
                return;
            }
            gameData.isHolding = true;
            let progress = 0;
            const plotDiv = document.getElementById('farmGrid').children[index];
            const progressCircle = document.createElement('div');
            progressCircle.className = 'hold-progress';
            progressCircle.innerHTML = '<div class="hold-progress-circle"></div>';
            plotDiv.appendChild(progressCircle);

            holdTimer = setInterval(() => {
                progress += 5;
                if (progress >= 100) {
                    stopPlowing();
                    finishPlowing(index);
                }
            }, 100);
        }

        function stopPlowing() {
            gameData.isHolding = false;
            clearInterval(holdTimer);
            document.querySelectorAll('.hold-progress').forEach(el => el.remove());
        }

        function finishPlowing(index) {
            gameData.farms[gameData.currentRegion].plots[index].plowed = true;
            gameData.energy -= 5;
            renderFarm();
            updateUI();
        }

        function startSpraying(index, event) {
            if (gameData.energy < 2) return;
            gameData.isSpraying = true;
            gameData.sprayTarget = index;
            document.body.classList.add('spray-cursor');

            // Efecto manguera
            const hose = document.createElement('div');
            hose.id = 'hoseEffect';
            hose.className = 'hose-effect';
            document.body.appendChild(hose);

            updateHosePosition(event);
            document.addEventListener('mousemove', updateHosePosition);

            let progress = 0;
            sprayTimer = setInterval(() => {
                progress += 5;
                if (progress >= 100) {
                    stopSpraying();
                    finishWatering(index);
                }
            }, 100);
        }

        function updateHosePosition(e) {
            const hose = document.getElementById('hoseEffect');
            if (hose) {
                hose.style.left = e.clientX + 'px';
                hose.style.top = e.clientY + 'px';
            }
        }

        function stopSpraying() {
            gameData.isSpraying = false;
            clearInterval(sprayTimer);
            document.body.classList.remove('spray-cursor');
            document.getElementById('hoseEffect')?.remove();
            document.removeEventListener('mousemove', updateHosePosition);
        }

        function finishWatering(index) {
            const cost = gameData.inventory.tools.regadera ? 1 : 2;
            gameData.farms[gameData.currentRegion].plots[index].watered = true;
            gameData.energy -= cost;
            renderFarm();
            updateUI();
        }

        function startFullHarvest(index) {
            const plot = gameData.farms[gameData.currentRegion].plots[index];
            const crop = crops[plot.planted];

            document.getElementById('harvestOverlay').classList.remove('hidden');
            document.getElementById('harvestTitle').textContent = `üçé Cosechando ${crop.name}`;
            const area = document.getElementById('harvestFruitArea');
            area.innerHTML = '';

            collectedFruits = 0;
            const totalToCollect = Math.ceil(plot.yieldAmount);
            document.getElementById('collectedCount').textContent = '0';
            document.getElementById('totalToCollect').textContent = ` / ${totalToCollect}`;

            for (let i = 0; i < totalToCollect; i++) {
                const fruit = document.createElement('div');
                fruit.className = 'harvest-fruit';
                fruit.textContent = crop.emoji;
                fruit.style.left = Math.random() * 80 + 10 + '%';
                fruit.style.top = Math.random() * 80 + 10 + '%';
                fruit.style.position = 'absolute';
                fruit.style.animationDelay = (Math.random() * 2) + 's';

                fruit.onclick = () => {
                    if (!fruit.classList.contains('picked')) {
                        fruit.classList.add('picked');
                        collectedFruits++;
                        document.getElementById('collectedCount').textContent = collectedFruits;
                        if (collectedFruits >= totalToCollect) {
                            setTimeout(() => finishFullHarvest(index, totalToCollect), 600);
                        }
                    }
                };
                area.appendChild(fruit);
            }
        }

        function finishFullHarvest(index, amount) {
            const farm = gameData.farms[gameData.currentRegion];
            const plot = farm.plots[index];
            const cropId = plot.planted;
            const crop = crops[cropId];

            if (!gameData.inventory.harvests[cropId]) gameData.inventory.harvests[cropId] = 0;
            gameData.inventory.harvests[cropId] += plot.yieldAmount;

            const xpGain = Math.floor(plot.yieldAmount * crop.pricePerUnit);
            gainXP(xpGain);

            farm.plots[index] = { planted: null, daysGrown: 0, watered: false, ready: false, yieldAmount: 0, plowed: false };

            document.getElementById('harvestOverlay').classList.add('hidden');
            renderFarm();
            renderQuickInventory();
            updateUI();
        }
    </script>
</body>

</html>